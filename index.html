<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trade Prompt Lab</title>
  <script src="config.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;900&family=JetBrains+Mono:wght@400;600&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root {
      --bg: #2d1b4e;
      --surface: #3a2460;
      --surface2: #452d72;
      --border: #5e4490;
      --border2: #4a3578;
      --text: #f0ebff;
      --text2: #b8a9d9;
      --text3: #8b7ab5;
      --accent: #00d4aa;
      --accent2: #7b9fff;
      --accent3: #ff6b6b;
      --accent4: #f5a623;
      --glow: rgba(0, 212, 170, 0.15);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #2d1b4e 0%, #3d2060 40%, #2a1a55 100%);
      background-attachment: fixed;
      color: var(--text);
      min-height: 100vh;
    }

    .mono { font-family: 'JetBrains Mono', monospace; }
    .display { font-family: 'Space Grotesk', sans-serif; }

    /* NAV */
    .nav-tab {
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      color: var(--text2);
      transition: all .2s;
      border: 1px solid transparent;
      white-space: nowrap;
    }
    .nav-tab:hover { color: var(--text); background: var(--surface2); }
    .nav-tab.active {
      color: var(--accent);
      background: rgba(0,212,170,0.1);
      border-color: rgba(0,212,170,0.3);
    }

    /* CARDS */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
    }

    .card-glow {
      box-shadow: 0 0 0 1px rgba(0,212,170,0.2), 0 8px 32px rgba(0,212,170,0.06);
    }

    /* CODE BLOCK */
    .code-box {
      background: #0b1220;
      border: 1px solid var(--border2);
      border-radius: 10px;
      padding: 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12.5px;
      line-height: 1.7;
      color: #7ee787;
      white-space: pre-wrap;
      word-break: break-all;
      min-height: 80px;
    }

    /* BADGE */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
    }

    /* INPUT */
    .inp {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 14px;
      color: var(--text);
      font-size: 13px;
      font-family: 'Noto Sans KR', sans-serif;
      transition: border-color .2s;
      resize: vertical;
    }
    .inp:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,212,170,0.1); }
    .inp::placeholder { color: var(--text3); }

    /* BTN */
    .btn-primary {
      background: linear-gradient(135deg, #00d4aa, #00b894);
      color: #0d1117;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 13px;
      transition: all .2s;
      font-family: 'Noto Sans KR', sans-serif;
    }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(0,212,170,0.4); }

    .btn-ghost {
      background: var(--surface2);
      color: var(--text2);
      font-weight: 600;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 9px 16px;
      cursor: pointer;
      font-size: 13px;
      transition: all .2s;
      font-family: 'Noto Sans KR', sans-serif;
    }
    .btn-ghost:hover { color: var(--text); border-color: var(--text3); }

    .btn-icon {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      width: 34px;
      height: 34px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text3);
      transition: all .2s;
    }
    .btn-icon:hover { color: var(--text); border-color: var(--text3); }
    .btn-icon.danger:hover { color: var(--accent3); border-color: var(--accent3); }

    /* SECTION PANEL */
    .panel { display: none; }
    .panel.active { display: block; }

    /* THEORY TABS */
    .theory-tab {
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      color: var(--text3);
      transition: all .2s;
      border: 1px solid transparent;
    }
    .theory-tab:hover { color: var(--text2); background: var(--surface2); }
    .theory-tab.active {
      color: var(--accent2);
      background: rgba(0,119,255,0.1);
      border-color: rgba(0,119,255,0.3);
    }

    /* Example card click */
    .example-pill {
      display: inline-block;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 4px 12px;
      font-size: 12px;
      color: var(--text2);
      cursor: pointer;
      transition: all .2s;
      margin: 3px;
    }
    .example-pill:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(0,212,170,0.08);
    }

    /* Tone slider */
    input[type=range] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 4px;
      background: linear-gradient(to right, var(--accent) 0%, var(--accent) var(--val, 25%), var(--border) var(--val, 25%), var(--border) 100%);
      cursor: pointer;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px; height: 18px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      border: 2px solid var(--bg);
      box-shadow: 0 0 8px rgba(0,212,170,0.5);
    }

    /* Archive card */
    .arch-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      transition: border-color .2s;
      cursor: default;
    }
    .arch-card:hover { border-color: rgba(0,212,170,0.4); }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text3); }

    /* Markdown render in preview */
    .md-render { color: var(--text); font-size: 13px; line-height: 1.8; }
    .md-render h1 { font-size: 1.1rem; font-weight: 800; color: var(--accent); margin: 8px 0 4px; }
    .md-render h2 { font-size: 1rem; font-weight: 700; color: #79c0ff; margin: 8px 0 4px; }
    .md-render pre { background: #0b1220; padding: 12px; border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 12px; color: #7ee787; overflow-x: auto; margin: 6px 0; }
    .md-render code { background: rgba(255,255,255,0.08); padding: 2px 6px; border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 12px; color: #ffcb6b; }
    .md-render blockquote { border-left: 3px solid var(--accent); padding-left: 12px; color: var(--text2); margin: 6px 0; font-style: italic; }
    .md-render ul { padding-left: 20px; margin: 4px 0; }
    .md-render li { margin: 2px 0; }
    .md-render table { border-collapse: collapse; width: 100%; margin: 8px 0; }
    .md-render th { background: var(--surface2); padding: 8px 12px; border: 1px solid var(--border); font-size: 12px; }
    .md-render td { padding: 7px 12px; border: 1px solid var(--border); font-size: 12px; }

    /* Theory section styles */
    .theory-block {
      background: var(--surface2);
      border-left: 3px solid var(--accent2);
      border-radius: 0 8px 8px 0;
      padding: 14px 16px;
      margin: 8px 0;
    }

    .type-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      transition: border-color .2s;
    }
    .type-card:hover { border-color: var(--accent2); }

    .tag-type {
      font-size: 11px;
      font-weight: 700;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'JetBrains Mono', monospace;
    }

    /* Step indicator */
    .step-num {
      width: 28px; height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent2), #00aaff);
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: 800;
      color: white; flex-shrink: 0;
    }

    /* Toast */
    #toast {
      position: fixed;
      bottom: 24px; right: 24px;
      background: var(--surface);
      border: 1px solid var(--accent);
      border-radius: 10px;
      padding: 12px 20px;
      color: var(--accent);
      font-size: 13px;
      font-weight: 600;
      z-index: 9999;
      transform: translateY(100px);
      opacity: 0;
      transition: all .3s cubic-bezier(.34, 1.56, .64, 1);
    }
    #toast.show { transform: translateY(0); opacity: 1; }

    /* Diff viewer */
    .diff-before { border-left: 3px solid var(--accent3); background: rgba(255,107,107,0.06); padding: 12px; border-radius: 0 8px 8px 0; }
    .diff-after  { border-left: 3px solid var(--accent); background: rgba(0,212,170,0.06); padding: 12px; border-radius: 0 8px 8px 0; }

    /* ì•„ì½”ë””ì–¸ */
    .accordion-body { max-height: 0; overflow: hidden; transition: max-height .4s ease; }
    .accordion-body.open { max-height: 2000px; }
    .accordion-arrow { transition: transform .3s; }
    .accordion-arrow.open { transform: rotate(180deg); }

    /* Pattern button group */
    .pattern-btn {
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--text2);
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all .2s;
      font-family: 'Noto Sans KR', sans-serif;
    }
    .pattern-btn:hover, .pattern-btn.active {
      border-color: var(--accent4);
      color: var(--accent4);
      background: rgba(245,166,35,0.08);
    }

    .label-sm {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .06em;
      color: var(--text3);
      margin-bottom: 6px;
      display: block;
    }

    .divider {
      border: none;
      border-top: 1px solid var(--border2);
      margin: 16px 0;
    }

    /* Grid columns */
    @media (max-width: 768px) {
      .grid-2 { grid-template-columns: 1fr !important; }
      .grid-3 { grid-template-columns: 1fr !important; }
    }

    /* Glow text */
    .glow-text {
      background: linear-gradient(135deg, var(--accent), #00b4d8, #0077ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* â”€â”€ AI ê´€ë ¨ ìŠ¤íƒ€ì¼ â”€â”€ */

    /* API Key ëª¨ë‹¬ */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(6px);
      z-index: 200;
      display: flex; align-items: center; justify-content: center;
    }
    .modal-overlay.hidden { display: none; }
    .modal-box {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px;
      width: min(440px, 92vw);
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }

    /* AI ì‘ë‹µ íŒ¨ë„ */
    .ai-panel {
      background: linear-gradient(135deg, rgba(0,212,170,0.04), rgba(0,119,255,0.04));
      border: 1px solid rgba(0,212,170,0.25);
      border-radius: 12px;
      padding: 16px;
      margin-top: 12px;
      display: none;
    }
    .ai-panel.visible { display: block; }
    .ai-panel-header {
      display: flex; align-items: center; gap: 8px;
      margin-bottom: 10px; font-size: 12px; font-weight: 700;
      color: var(--accent);
    }

    /* ìŠ¤íŠ¸ë¦¬ë° ì»¤ì„œ */
    .ai-cursor::after {
      content: "â–‹";
      animation: blink 1s step-end infinite;
      color: var(--accent);
    }
    @keyframes blink { 50% { opacity: 0; } }

    /* AI ë²„íŠ¼ */
    .btn-ai {
      background: linear-gradient(135deg, rgba(0,212,170,0.15), rgba(0,119,255,0.15));
      border: 1px solid rgba(0,212,170,0.4);
      color: var(--accent);
      font-weight: 700;
      border-radius: 8px;
      padding: 9px 16px;
      cursor: pointer;
      font-size: 12px;
      transition: all .2s;
      font-family: 'Noto Sans KR', sans-serif;
      display: flex; align-items: center; gap: 6px;
      white-space: nowrap;
    }
    .btn-ai:hover {
      background: linear-gradient(135deg, rgba(0,212,170,0.25), rgba(0,119,255,0.25));
      border-color: var(--accent);
      box-shadow: 0 4px 16px rgba(0,212,170,0.2);
    }
    .btn-ai:disabled {
      opacity: 0.5; cursor: not-allowed;
      box-shadow: none; transform: none;
    }

    /* API ìƒíƒœ ë±ƒì§€ */
    .api-badge {
      display: flex; align-items: center; gap: 5px;
      font-size: 11px; font-weight: 600;
      padding: 4px 10px; border-radius: 20px;
      cursor: pointer; transition: all .2s;
    }
    .api-badge.connected {
      background: rgba(0,212,170,0.1);
      border: 1px solid rgba(0,212,170,0.3);
      color: var(--accent);
    }
    .api-badge.disconnected {
      background: rgba(255,107,107,0.1);
      border: 1px solid rgba(255,107,107,0.3);
      color: #ff6b6b;
    }
    .api-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
    }
    .api-dot.on  { background: var(--accent); box-shadow: 0 0 6px var(--accent); }
    .api-dot.off { background: #ff6b6b; }

    /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
    .spinner {
      width: 16px; height: 16px;
      border: 2px solid rgba(0,212,170,0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin .7s linear infinite;
      display: inline-block;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ì ìˆ˜ ë°” */
    .score-bar-wrap { background: var(--surface2); border-radius: 4px; height: 6px; overflow: hidden; }
    .score-bar-fill { height: 100%; border-radius: 4px; transition: width .5s ease; }
  </style>
</head>

<body>

<!-- TOAST -->
<div id="toast"></div>

<!-- API KEY MODAL (config.js ì•ˆë‚´ìš©) -->
<div id="apiModal" class="modal-overlay hidden">
  <div class="modal-box">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
      <div style="display:flex;align-items:center;gap:10px;">
        <div style="width:32px;height:32px;background:linear-gradient(135deg,#00d4aa,#0077ff);border-radius:8px;display:flex;align-items:center;justify-content:center;">
          <i class="fa-solid fa-key" style="color:white;font-size:13px;"></i>
        </div>
        <div style="font-size:16px;font-weight:700;">API í‚¤ ì„¤ì • ì•ˆë‚´</div>
      </div>
      <button onclick="closeApiModal()" style="background:none;border:none;color:var(--text3);cursor:pointer;font-size:18px;">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <div id="apiModalStatus" style="margin-bottom:16px;padding:12px;border-radius:10px;font-size:13px;line-height:1.8;"></div>

    <div style="background:var(--surface2);border-radius:10px;padding:14px;margin-bottom:16px;font-size:12px;line-height:1.9;color:var(--text2);">
      <div style="font-weight:700;color:var(--text);margin-bottom:8px;">
        <i class="fa-solid fa-file-code" style="color:var(--accent);margin-right:6px;"></i>
        <code style="color:var(--accent);">config.js</code> íŒŒì¼ì— í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”
      </div>
      <div style="background:#0b1220;border-radius:8px;padding:12px;font-family:'JetBrains Mono',monospace;font-size:11.5px;color:#7ee787;margin-bottom:10px;">
const ANTHROPIC_CONFIG = {<br>
&nbsp;&nbsp;apiKey: "<span style="color:#f5a623;">sk-ant-ì—¬ê¸°ì—_í‚¤_ì…ë ¥</span>",<br>
};</div>
      <div style="display:grid;gap:6px;">
        <div style="display:flex;align-items:start;gap:8px;">
          <span style="color:var(--accent);font-weight:700;flex-shrink:0;">â‘ </span>
          <span><a href="https://console.anthropic.com" target="_blank" style="color:var(--accent);">console.anthropic.com</a>ì—ì„œ API í‚¤ ë°œê¸‰</span>
        </div>
        <div style="display:flex;align-items:start;gap:8px;">
          <span style="color:var(--accent);font-weight:700;flex-shrink:0;">â‘¡</span>
          <span><code style="background:rgba(255,255,255,0.08);padding:1px 6px;border-radius:4px;">config.js</code> íŒŒì¼ì„ ì—´ê³  í‚¤ ë¶™ì—¬ë„£ê¸°</span>
        </div>
        <div style="display:flex;align-items:start;gap:8px;">
          <span style="color:var(--accent);font-weight:700;flex-shrink:0;">â‘¢</span>
          <span>ë¸Œë¼ìš°ì €ì—ì„œ HTML íŒŒì¼ì„ ìƒˆë¡œê³ ì¹¨ (<code style="background:rgba(255,255,255,0.08);padding:1px 6px;border-radius:4px;">F5</code>)</span>
        </div>
        <div style="display:flex;align-items:start;gap:8px;">
          <span style="color:#f5a623;font-weight:700;flex-shrink:0;">âš ï¸</span>
          <span><code style="background:rgba(255,255,255,0.08);padding:1px 6px;border-radius:4px;">config.js</code>ë¥¼ <strong style="color:var(--text);">ì ˆëŒ€ GitHub ë“± ê³µê°œ ì €ì¥ì†Œì— ì—…ë¡œë“œí•˜ì§€ ë§ˆì„¸ìš”.</strong></span>
        </div>
      </div>
    </div>

    <button class="btn-primary" style="width:100%;" onclick="closeApiModal()">í™•ì¸</button>
  </div>
</div>

<!-- AI EXPLAIN MODAL -->
<div id="aiExplainModal" class="modal-overlay hidden">
  <div class="modal-box" style="width:min(680px,95vw);max-height:85vh;overflow-y:auto;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
      <div style="display:flex;align-items:center;gap:10px;">
        <div style="width:32px;height:32px;background:linear-gradient(135deg,#00d4aa,#0077ff);border-radius:8px;display:flex;align-items:center;justify-content:center;">
          <i class="fa-solid fa-brain" style="color:white;font-size:13px;"></i>
        </div>
        <div>
          <div style="font-size:15px;font-weight:700;" id="explainTitle">AI ì‹¬í™” ì„¤ëª…</div>
          <div style="font-size:11px;color:var(--text3);">Claude Sonnetì´ ìƒì„±í•œ ì„¤ëª…</div>
        </div>
      </div>
      <button onclick="closeExplainModal()" style="background:none;border:none;color:var(--text3);cursor:pointer;font-size:18px;">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div id="explainContent" class="md-render" style="font-size:13px;line-height:1.8;min-height:80px;">
      <div style="display:flex;align-items:center;gap:8px;color:var(--text3);">
        <div class="spinner"></div> AIê°€ ì„¤ëª…ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...
      </div>
    </div>
  </div>
</div>

<!-- HEADER -->
<header style="background:var(--surface);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;">
  <div style="max-width:1280px;margin:0 auto;padding:0 20px;">
    <div style="display:flex;align-items:center;justify-content:space-between;height:60px;gap:16px;">
      <div style="display:flex;align-items:center;gap:12px;flex-shrink:0;">
        <div style="width:36px;height:36px;background:linear-gradient(135deg,#00d4aa,#0077ff);border-radius:10px;display:flex;align-items:center;justify-content:center;">
          <i class="fa-solid fa-flask" style="color:white;font-size:15px;"></i>
        </div>
        <div>
          <div class="display" style="font-size:16px;font-weight:700;letter-spacing:-.02em;">
            Trade Prompt <span class="glow-text">Lab</span>
          </div>
          <div style="font-size:11px;color:var(--text3);">í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì‹¤í—˜ì‹¤ v3</div>
        </div>
      </div>

      <!-- NAV TABS -->
      <nav style="display:flex;gap:4px;overflow-x:auto;flex:1;justify-content:center;">
        <button class="nav-tab active" onclick="switchPanel('theory')">
          <i class="fa-solid fa-book-open mr-1"></i>ê¸°ì´ˆ ì´ë¡ 
        </button>
        <button class="nav-tab" onclick="switchPanel('builder')">
          <i class="fa-solid fa-wand-magic-sparkles mr-1"></i>ë¹Œë”
        </button>
        <button class="nav-tab" onclick="switchPanel('examples')">
          <i class="fa-solid fa-lightbulb mr-1"></i>ì‹¤ìŠµ ì˜ˆì‹œ
        </button>
        <button class="nav-tab" onclick="switchPanel('archive')">
          <i class="fa-solid fa-box-archive mr-1"></i>ì•„ì¹´ì´ë¸Œ
          <span id="archCount" style="background:rgba(0,212,170,0.2);color:var(--accent);padding:1px 6px;border-radius:10px;font-size:10px;margin-left:4px;">0</span>
        </button>
      </nav>

      <div style="display:flex;gap:6px;align-items:center;flex-shrink:0;">
        <!-- API ìƒíƒœ ë±ƒì§€ -->
        <div id="apiBadge" class="api-badge disconnected" onclick="openApiModal()" title="API í‚¤ ì„¤ì •">
          <div id="apiDot" class="api-dot off"></div>
          <span id="apiStatus">API ë¯¸ì—°ê²°</span>
        </div>
        <button class="btn-ghost" onclick="exportArchive()" title="Export JSON">
          <i class="fa-solid fa-file-export"></i>
        </button>
        <label class="btn-ghost" style="cursor:pointer;" title="Import JSON">
          <i class="fa-solid fa-file-import"></i>
          <input id="fileImport" type="file" accept="application/json" style="display:none;" onchange="importArchive(this)"/>
        </label>
      </div>
    </div>
  </div>
</header>

<main style="max-width:1280px;margin:0 auto;padding:24px 20px;">

  <!-- ===================== PANEL: THEORY ===================== -->
  <div id="panel-theory" class="panel active">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:gap 8px;">
      <div>
        <h2 class="display" style="font-size:20px;font-weight:700;">ê¸°ì´ˆ ì´ë¡  í•™ìŠµ</h2>
        <p style="color:var(--text2);font-size:13px;margin-top:4px;">í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì˜ í•µì‹¬ ì›ì¹™ì„ ì •ë¦¬í•œ ë ˆí¼ëŸ°ìŠ¤</p>
      </div>
    </div>

    <!-- Theory sub-tabs -->
    <div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:20px;background:var(--surface);padding:8px;border-radius:10px;border:1px solid var(--border);">
      <button class="theory-tab active" onclick="switchTheory('t1')">â‘  í”„ë¡¬í”„íŠ¸ ìœ í˜•</button>
      <button class="theory-tab" onclick="switchTheory('t2')">â‘¡ ìƒ· ê¸°ë²•</button>
      <button class="theory-tab" onclick="switchTheory('t3')">â‘¢ í˜ë¥´ì†Œë‚˜ íŒ¨í„´</button>
      <button class="theory-tab" onclick="switchTheory('t4')">â‘£ ë§ˆí¬ë‹¤ìš´ êµ¬ì¡°í™”</button>
      <button class="theory-tab" onclick="switchTheory('t5')">â‘¤ í‘œí˜„ ê°•ë„ ì¡°ì ˆ</button>
      <button class="theory-tab" onclick="switchTheory('t6')">â‘¥ ëŒ€ì•ˆ ì ‘ê·¼ë²• íŒ¨í„´</button>
      <button class="theory-tab" onclick="switchTheory('t7')">â‘¦ ë ˆì‹œí”¼ íŒ¨í„´</button>
      <button class="theory-tab" onclick="switchTheory('t8')">â‘§ ë’¤ì§‘íŒ ìƒí˜¸ì‘ìš©</button>
      <button class="theory-tab" onclick="switchTheory('t9')">â‘¨ ì¸ì§€ ê²€ì¦ì íŒ¨í„´</button>
      <div style="flex:1;"></div>
      <button class="btn-ai" id="btnAiExplain" onclick="aiExplainCurrentTheory()">
        <i class="fa-solid fa-brain"></i> AI ì‹¬í™” ì„¤ëª…
      </button>
    </div>

    <!-- T1: í”„ë¡¬í”„íŠ¸ 3ìœ í˜• -->
    <div id="t1" class="theory-panel">
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;" class="grid-3">

        <!-- ì„œìˆ í˜• -->
        <div class="type-card">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
            <span class="tag-type" style="background:rgba(255,107,107,0.15);color:#ff6b6b;">ì„œìˆ í˜•</span>
            <span style="font-size:12px;color:var(--text2);">ë§¥ë½Â·ë°°ê²½ ì„¤ëª…</span>
          </div>
          <p style="font-size:13px;color:var(--text2);line-height:1.7;margin-bottom:12px;">
            AIê°€ ìƒí™©ì„ ì´í•´í•˜ë„ë¡ <strong style="color:var(--text);">ë°°ê²½ê³¼ ë§¥ë½</strong>ì„ í’ë¶€í•˜ê²Œ ì„¤ëª…í•˜ëŠ” ë°©ì‹. ììœ ë¡œìš´ ë‹µë³€ì´ í•„ìš”í•  ë•Œ ì í•©.
          </p>
          <div class="code-box" style="font-size:11.5px;">
# ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ ë¬´ì—­ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
# ì¤‘ì†Œê¸°ì—… ìˆ˜ì¶œ ë‹´ë‹¹ìê°€ HS Codeë¥¼
  ì²˜ìŒ ë°°ìš°ëŠ” ìƒí™©ì…ë‹ˆë‹¤.
# ì´ ì‚¬ëŒì—ê²Œ HS Codeì˜ ê°œë…ê³¼
  ì¤‘ìš”ì„±ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</div>
          <div class="theory-block" style="margin-top:12px;border-color:#ff6b6b;">
            <div style="font-size:12px;color:var(--text2);">
              âœ” ììœ ë¡œìš´ ì„¤ëª…ì´ í•„ìš”í•  ë•Œ<br>
              âœ” AIì—ê²Œ ì¶©ë¶„í•œ ë°°ê²½ì„ ì¤„ ë•Œ<br>
              âœ— ì¼ê´€ëœ í¬ë§· ì¶œë ¥ì´ í•„ìš”í•  ë•ŒëŠ” ë¶€ì í•©
            </div>
          </div>
        </div>

        <!-- ì§€ì¹¨í˜• -->
        <div class="type-card">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
            <span class="tag-type" style="background:rgba(0,119,255,0.15);color:#0077ff;">ì§€ì¹¨í˜•</span>
            <span style="font-size:12px;color:var(--text2);">ë‹¨ê³„ë³„ ê·œì¹™ ì œì‹œ</span>
          </div>
          <p style="font-size:13px;color:var(--text2);line-height:1.7;margin-bottom:12px;">
            <strong style="color:var(--text);">ë‹¨ê³„ë³„ ì ˆì°¨ë‚˜ ëª…í™•í•œ ê·œì¹™</strong>ì„ ì œì‹œ. ì¼ê´€ëœ ì¶œë ¥ í’ˆì§ˆì´ í•„ìš”í•  ë•Œ ìµœì .
          </p>
          <div class="code-box" style="font-size:11.5px;">
# ë‹¤ìŒ ê·œì¹™ì— ë”°ë¼ Python ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”
1. í•¨ìˆ˜ëª…ì€ snake_caseë¡œ ì‘ì„±
2. ê° í•¨ìˆ˜ì˜ docstring(ì£¼ì„) í¬í•¨
3. ì˜ˆì™¸ ì²˜ë¦¬ ë°˜ë“œì‹œ í¬í•¨
4. ê²°ê³¼ëŠ” JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜</div>
          <div class="theory-block" style="margin-top:12px;border-color:#0077ff;">
            <div style="font-size:12px;color:var(--text2);">
              âœ” ì½”ë“œÂ·ë¬¸ì„œ ì‘ì„± ê·œì¹™ ì ìš©<br>
              âœ” ë°˜ë³µ ì‘ì—… ìë™í™”<br>
              âœ— ì°½ì˜ì Â·íƒìƒ‰ì  ì‘ì—…ì—ëŠ” ë”±ë”±í•¨
            </div>
          </div>
        </div>

        <!-- í•¨ìˆ˜í˜• -->
        <div class="type-card">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
            <span class="tag-type" style="background:rgba(0,212,170,0.15);color:var(--accent);">í•¨ìˆ˜í˜•</span>
            <span style="font-size:12px;color:var(--text2);">ì…ì¶œë ¥ ëª…í™• ì •ì˜</span>
          </div>
          <p style="font-size:13px;color:var(--text2);line-height:1.7;margin-bottom:12px;">
            <strong style="color:var(--text);">ì…ë ¥Â·ì²˜ë¦¬Â·ì¶œë ¥ì„ ëª…í™•íˆ ì •ì˜</strong>í•˜ì—¬ ì¼ê´€ëœ ê²°ê³¼ë¥¼ ìƒì„±. ìë™í™”Â·ë°ì´í„° ì²˜ë¦¬ì— ìµœê°•.
          </p>
          <div class="code-box" style="font-size:11.5px;">
# ì…ë ¥: {product_name}, {hs_code}, {country}
# ì²˜ë¦¬: í•´ë‹¹ êµ­ê°€ì˜ ê´€ì„¸ìœ¨ ë° ê·œì œ ì¡°íšŒ
# ì¶œë ¥: {
    "ê´€ì„¸ìœ¨": "",
    "ê·œì œì‚¬í•­": [],
    "í•„ìš”ì„œë¥˜": []
  }</div>
          <div class="theory-block" style="margin-top:12px;border-color:var(--accent);">
            <div style="font-size:12px;color:var(--text2);">
              âœ” ë°ì´í„° ì¶”ì¶œÂ·ë³€í™˜ ìë™í™”<br>
              âœ” í•­ìƒ ê°™ì€ í¬ë§· ì¶œë ¥<br>
              âœ— ì„œìˆ ì  ì„¤ëª…ì—ëŠ” ê³¼ì‰ êµ¬ì¡°í™”
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- T2: ìƒ· ê¸°ë²• -->
    <div id="t2" class="theory-panel" style="display:none;">
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;" class="grid-3">

        <div class="type-card">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
            <span class="tag-type" style="background:rgba(255,107,107,0.15);color:#ff6b6b;">ì œë¡œìƒ·</span>
            <span style="font-size:12px;color:var(--text2);">ì˜ˆì‹œ ì—†ì´ ì§ì ‘ ì§€ì‹œ</span>
          </div>
          <p style="font-size:13px;color:var(--text2);line-height:1.7;margin-bottom:12px;">
            ì˜ˆì‹œ ì—†ì´ ë°”ë¡œ ì§ˆë¬¸. ê°„ë‹¨í•œ ì‘ì—…ì´ë‚˜ AIê°€ ì˜ ì•„ëŠ” ë¶„ì•¼ì— ì í•©.
          </p>
          <div class="code-box" style="font-size:11.5px;">
ì´ ì œí’ˆ ì •ë§ ë§˜ì— ë“¤ì–´.

â†’ ê°ì •ì„ ë¶„ë¥˜í•´ ì£¼ì„¸ìš”.</div>
          <div style="margin-top:12px;display:flex;align-items:center;gap:8px;">
            <span class="badge" style="background:rgba(255,107,107,0.1);color:#ff6b6b;">ë¹ ë¦„</span>
            <span style="font-size:12px;color:var(--text3);">ë‹¨ìˆœ ì‘ì—… / íƒìƒ‰ ë‹¨ê³„</span>
          </div>
        </div>

        <div class="type-card">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
            <span class="tag-type" style="background:rgba(245,166,35,0.15);color:#f5a623;">ì›ìƒ·</span>
            <span style="font-size:12px;color:var(--text2);">ì˜ˆì‹œ 1ê°œ ì œê³µ</span>
          </div>
          <p style="font-size:13px;color:var(--text2);line-height:1.7;margin-bottom:12px;">
            ì˜ˆì‹œ 1ê°œë¡œ íŒ¨í„´ì„ í•™ìŠµì‹œí‚´. í¬ë§·ì´ë‚˜ ìŠ¤íƒ€ì¼ì„ ê°€ì´ë“œí•  ë•Œ.
          </p>
          <div class="code-box" style="font-size:11.5px;">
ê°ì •ì„ ë¶„ë¥˜í•´ ì£¼ì„¸ìš”.

ì˜ˆì‹œ)
"ë°°ì†¡ì´ ë„ˆë¬´ ëŠ¦ì–´ì„œ ì‹¤ë§í–ˆì–´ìš”."
â†’ ê°ì •: ë¶€ì •

"ì´ ì œí’ˆ ì •ë§ ë§˜ì— ë“¤ì–´" â†’ ê°ì •:</div>
          <div style="margin-top:12px;display:flex;align-items:center;gap:8px;">
            <span class="badge" style="background:rgba(245,166,35,0.1);color:#f5a623;">ì ë‹¹</span>
            <span style="font-size:12px;color:var(--text3);">í¬ë§· ê°€ì´ë“œ í•„ìš” ì‹œ</span>
          </div>
        </div>

        <div class="type-card">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
            <span class="tag-type" style="background:rgba(0,212,170,0.15);color:var(--accent);">í“¨ìƒ·</span>
            <span style="font-size:12px;color:var(--text2);">ì˜ˆì‹œ 2ê°œ ì´ìƒ</span>
          </div>
          <p style="font-size:13px;color:var(--text2);line-height:1.7;margin-bottom:12px;">
            2ê°œ ì´ìƒ ì˜ˆì‹œë¡œ ì •í™•í•œ íŒ¨í„´ í•™ìŠµ. ë³µì¡í•œ ë¶„ë¥˜Â·ë³€í™˜ ì‘ì—…ì— ìµœì .
          </p>
          <div class="code-box" style="font-size:11.5px;">
ê°ì • ë¶„ë¥˜(ê¸ì •/ë¶€ì •/ì¤‘ë¦½):

"ë°°ì†¡ì´ ëŠ¦ì–´ì„œ ì‹¤ë§" â†’ ë¶€ì •
"ê·¸ëƒ¥ í‰ë²”í•œ ì œí’ˆ" â†’ ì¤‘ë¦½
"ì—­ëŒ€ê¸‰ ë§Œì¡±" â†’ ê¸ì •
"í’ˆì§ˆ ì¢‹ì€ë° ê°€ê²© ë¹„ì‹¸" â†’ ì¤‘ë¦½

"ì´ ì œí’ˆ ì •ë§ ë§˜ì— ë“¤ì–´" â†’ ?</div>
          <div style="margin-top:12px;display:flex;align-items:center;gap:8px;">
            <span class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">ì •ë°€</span>
            <span style="font-size:12px;color:var(--text3);">ë¶„ë¥˜Â·ë³€í™˜ ìë™í™”</span>
          </div>
        </div>
      </div>

      <!-- ë¬´ì—­ í“¨ìƒ· ì˜ˆì‹œ -->
      <div class="card" style="margin-top:16px;border-color:rgba(0,212,170,0.3);">
        <div style="font-size:13px;font-weight:700;color:var(--accent);margin-bottom:10px;">
          <i class="fa-solid fa-star mr-1"></i>ë¬´ì—­ ì‹¤ë¬´ í“¨ìƒ· ì˜ˆì‹œ â€” HS Code ë¶„ë¥˜
        </div>
        <div class="code-box">
** HS Codeë¥¼ ë¶„ë¥˜í•´ì£¼ì„¸ìš”

ì˜ˆì‹œ)
í’ˆëª©: "ë©´ìœ¼ë¡œ ë§Œë“  ë‚¨ì„±ìš© í‹°ì…”ì¸ " -> 6109.10
í’ˆëª©: "í´ë¦¬ì—ìŠ¤í…Œë¥´ ì†Œì¬ ì—¬ì„± ë¸”ë¼ìš°ìŠ¤" -> 6110.10
í’ˆëª©: "ì•„ë™ìš© ë°ë‹˜ ë°”ì§€" -> 6111.10

í’ˆëª©: "ìš¸ í˜¼ë°© ë‚¨ì„± ì¬í‚·" -> HS Code?

â†’ ì •ë‹µ: 6203.31 (ìš¸ ì†Œì¬ ë‚¨ì„± ì¬í‚·, ì§ë¬¼ ê¸°ì¤€)</div>
      </div>
    </div>

    <!-- T3: í˜ë¥´ì†Œë‚˜ -->
    <div id="t3" class="theory-panel" style="display:none;">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;" class="grid-2">
        <div class="card">
          <div style="font-size:14px;font-weight:700;margin-bottom:12px;color:var(--accent2);">
            <i class="fa-solid fa-circle-question mr-1"></i>í˜ë¥´ì†Œë‚˜ê°€ ì™œ ì¤‘ìš”í•œê°€?
          </div>
          <p style="font-size:13px;color:var(--text2);line-height:1.8;">
            ê°™ì€ ì§ˆë¬¸ "ì´ ê³„ì•½ì„œ ê²€í† í•´ì¤˜"ë„ í˜ë¥´ì†Œë‚˜ì— ë”°ë¼ ì™„ì „íˆ ë‹¤ë¥¸ ë‹µë³€ì´ ë‚˜ì˜µë‹ˆë‹¤.
          </p>
          <div style="margin-top:12px;display:grid;gap:8px;">
            <div class="theory-block" style="border-color:#ff6b6b;">
              <div style="font-size:12px;"><strong style="color:#ff6b6b;">ë³€í˜¸ì‚¬</strong> í˜ë¥´ì†Œë‚˜: ë²•ì  ë¦¬ìŠ¤í¬ ì¤‘ì‹¬ ë¶„ì„</div>
            </div>
            <div class="theory-block" style="border-color:#f5a623;">
              <div style="font-size:12px;"><strong style="color:#f5a623;">CFO</strong> í˜ë¥´ì†Œë‚˜: ì¬ë¬´ì¡°ê±´Â·ìˆ˜ìµì„± ë¶„ì„</div>
            </div>
            <div class="theory-block" style="border-color:#0077ff;">
              <div style="font-size:12px;"><strong style="color:#0077ff;">ì‹ ì…ì‚¬ì›</strong> í˜ë¥´ì†Œë‚˜: ì‰½ê³  ì¹œì ˆí•œ ì„¤ëª…</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div style="font-size:14px;font-weight:700;margin-bottom:12px;color:var(--accent2);">
            <i class="fa-solid fa-layer-group mr-1"></i>ì¢‹ì€ í˜ë¥´ì†Œë‚˜ 4ìš”ì†Œ
          </div>
          <div style="display:grid;gap:8px;">
            <div style="display:flex;align-items:center;gap:10px;background:var(--surface2);padding:10px;border-radius:8px;">
              <div class="step-num">1</div>
              <div><div style="font-size:12px;font-weight:700;">ì—­í•  (Role)</div><div style="font-size:11px;color:var(--text3);">ë‹¹ì‹ ì€ [ì—­í• ]ì…ë‹ˆë‹¤</div></div>
            </div>
            <div style="display:flex;align-items:center;gap:10px;background:var(--surface2);padding:10px;border-radius:8px;">
              <div class="step-num">2</div>
              <div><div style="font-size:12px;font-weight:700;">ê²½ë ¥/ë°°ê²½ (Background)</div><div style="font-size:11px;color:var(--text3);">[ê²½ë ¥/ë°°ê²½]ì„ ê°€ì§€ê³  ìˆìœ¼ë©°</div></div>
            </div>
            <div style="display:flex;align-items:center;gap:10px;background:var(--surface2);padding:10px;border-radius:8px;">
              <div class="step-num">3</div>
              <div><div style="font-size:12px;font-weight:700;">ì „ë¬¸ ë¶„ì•¼ (Expertise)</div><div style="font-size:11px;color:var(--text3);">[ë¶„ì•¼]ì— íŠ¹í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤</div></div>
            </div>
            <div style="display:flex;align-items:center;gap:10px;background:var(--surface2);padding:10px;border-radius:8px;">
              <div class="step-num">4</div>
              <div><div style="font-size:12px;font-weight:700;">ë§íˆ¬/íƒœë„ (Tone)</div><div style="font-size:11px;color:var(--text3);">[ìŠ¤íƒ€ì¼]ë¡œ ì‘ë‹µí•˜ì„¸ìš”</div></div>
            </div>
          </div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;" class="grid-3">
        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:var(--accent);margin-bottom:8px;">ê´€ì„¸ì‚¬ í˜ë¥´ì†Œë‚˜</div>
          <div class="code-box" style="font-size:11px;">"ë‹¹ì‹ ì€ 20ë…„ ê²½ë ¥ì˜ ê´€ì„¸ì‚¬ì…ë‹ˆë‹¤.
FTA í˜‘ì •ì„¸ìœ¨ê³¼ ì›ì‚°ì§€ ê·œì •ì˜ ì „ë¬¸ê°€ë¡œ,
ì¤‘ì†Œê¸°ì—… ë¬´ì—­ ë‹´ë‹¹ìì—ê²Œ ë³µì¡í•œ ë‚´ìš©ì„
ì‰½ê³  ì‹¤ìš©ì ìœ¼ë¡œ ì„¤ëª…í•˜ëŠ” ê²ƒì´ íŠ¹ê¸°ì…ë‹ˆë‹¤."</div>
        </div>
        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:#ff6b6b;margin-bottom:8px;">ë¹„í‰ê°€ í˜ë¥´ì†Œë‚˜</div>
          <div class="code-box" style="font-size:11px;">"ë‹¹ì‹ ì€ ê¹Œë‹¤ë¡œìš´ ì‹œë‹ˆì–´ ê°œë°œìì…ë‹ˆë‹¤.
ì½”ë“œ ë¦¬ë·° ì‹œ ì„±ëŠ¥Â·ë³´ì•ˆÂ·ê°€ë…ì„±ì„ ì—„ê²©íˆ í‰ê°€í•˜ë©°,
ì¹­ì°¬ë³´ë‹¤ ê°œì„ ì ì„ ë¨¼ì € ì§€ì í•˜ëŠ” ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤."</div>
        </div>
        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:#f5a623;margin-bottom:8px;">ë©€í‹° í˜ë¥´ì†Œë‚˜</div>
          <div class="code-box" style="font-size:11px;">
# ê¹€ ë¶€ì¥ (ì˜ì—… 15ë…„, ë‚™ê´€ì , í˜„ì¥ ì¤‘ì‹¬)
# ì´ ë°•ì‚¬ (ì‹œì¥ì¡°ì‚¬, ë°ì´í„° ì¤‘ì‹¬, ì‹ ì¤‘)
# ë°• ëŒ€í‘œ (ìŠ¤íƒ€íŠ¸ì—…, ì†ë„ ì¤‘ì‹œ, ë¦¬ìŠ¤í¬ ê°ìˆ˜)

ê°ì ì°¬ë°˜ ì˜ê²¬ì„ ì œì‹œí•˜ì„¸ìš”.</div>
        </div>
      </div>
    </div>

    <!-- T4: ë§ˆí¬ë‹¤ìš´ êµ¬ì¡°í™” -->
    <div id="t4" class="theory-panel" style="display:none;">
      <div class="card" style="margin-bottom:16px;border-color:rgba(0,119,255,0.3);">
        <p style="font-size:13px;color:var(--text2);line-height:1.7;">
          AIëŠ” í…ìŠ¤íŠ¸ë¥¼ <strong style="color:var(--text);">êµ¬ì¡°ì ìœ¼ë¡œ íŒŒì‹±</strong>í•©ë‹ˆë‹¤. ë§ˆí¬ë‹¤ìš´ì„ í™œìš©í•˜ë©´ ì—­í• Â·ì¡°ê±´Â·ì¶œë ¥í˜•íƒœê°€ ëª…í™•íˆ êµ¬ë¶„ë˜ì–´ <strong style="color:var(--accent);">ë” ì •í™•í•˜ê³  ì¼ê´€ëœ ì‘ë‹µ</strong>ì„ ì´ëŒì–´ëƒ…ë‹ˆë‹¤.
        </p>
      </div>

      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px;" class="grid-3">

        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:var(--accent);margin-bottom:8px;font-family:'JetBrains Mono',monospace;"># í—¤ë” â€” í”„ë¡¬í”„íŠ¸ì˜ ë¼ˆëŒ€</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:8px;">ì„¹ì…˜ì„ ë‚˜ëˆ  ì—­í• Â·ì‘ì—…Â·ì¶œë ¥ì„ ëª…í™•íˆ ë¶„ë¦¬</p>
          <div class="code-box" style="font-size:11px;">#ì—­í• 
ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ ê´€ì„¸ì‚¬ì…ë‹ˆë‹¤.
#ì‘ì—…
HS Codeë¥¼ ë¶„ë¥˜í•˜ì„¸ìš”.
#ì¶œë ¥í˜•ì‹
JSONìœ¼ë¡œ ë°˜í™˜í•˜ì„¸ìš”.</div>
        </div>

        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:#ffcb6b;margin-bottom:8px;font-family:'JetBrains Mono',monospace;">``` ì½”ë“œë¸”ë¡ â€” ì…ë ¥ ë°ì´í„° ê²©ë¦¬</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:8px;">ì§€ì‹œë¬¸ê³¼ ë°ì´í„°ë¥¼ í˜¼ë™í•˜ì§€ ì•Šê²Œ ë¶„ë¦¬</p>
          <div class="code-box" style="font-size:11px;">ì•„ë˜ Python ì½”ë“œì˜ ë²„ê·¸ë¥¼ ì°¾ì•„ì£¼ì„¸ìš”

```python
def calculate_tax(price):
    return price*0.1
print("ì™„ë£Œ")  # ë²„ê·¸ ìœ„ì¹˜
```</div>
        </div>

        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:#79c0ff;margin-bottom:8px;font-family:'JetBrains Mono',monospace;">&gt; ì¸ìš©ë¬¸ â€” í•µì‹¬ ê°•ì¡°</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:8px;">ì ˆëŒ€ ì§€ì¼œì•¼ í•  ì¡°ê±´Â·ì¤‘ìš”í•œ ë§¥ë½ ë¶€ê°</p>
          <div class="code-box" style="font-size:11px;">&gt; ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œë§Œ ë‹µë³€í•˜ì„¸ìš”
&gt; ì¶”ì¸¡ì„± ë‚´ìš©ì€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”
&gt; ë¶ˆí™•ì‹¤í•œ ì„¸ìœ¨ì€ "ì„¸ê´€ í™•ì¸ í•„ìš”"ë¡œ í‘œê¸°</div>
        </div>

        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:#f5a623;margin-bottom:8px;font-family:'JetBrains Mono',monospace;">- ëª©ë¡ â€” ì¡°ê±´Â·ì œì•½ ë‚˜ì—´</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:8px;">ì œì•½ì¡°ê±´ì„ ëª…í™•í•˜ê²Œ ëª©ë¡í™”</p>
          <div class="code-box" style="font-size:11px;">## ì œì•½ì¡°ê±´
- ë‹µë³€ì€ 500ì ì´ë‚´
- ì „ë¬¸ ìš©ì–´ ì‚¬ìš© ì‹œ ê´„í˜¸ ì„¤ëª… ì¶”ê°€
- ë¶ˆí™•ì‹¤í•œ ë‚´ìš©ì€ "í™•ì¸ í•„ìš”" í‘œì‹œ
- ì˜ˆì‹œëŠ” ë¬´ì—­ ë„ë©”ì¸ì—ì„œ ì„ íƒ</div>
        </div>

        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:#c3e88d;margin-bottom:8px;font-family:'JetBrains Mono',monospace;">| í‘œ â€” ì…ì¶œë ¥ êµ¬ì¡° ì˜ˆì‹œ</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:8px;">ì˜ˆì‹œ ë°ì´í„°ë¥¼ êµ¬ì¡°ì ìœ¼ë¡œ ì œì‹œ</p>
          <div class="code-box" style="font-size:11px;">## ì˜ˆì‹œ
| ì…ë ¥ í’ˆëª©  | HS Code | ê´€ì„¸ìœ¨ |
| ë©´ í‹°ì…”ì¸   | 6109.10 |  13%  |
| ë¸”ë¼ìš°ìŠ¤   | 6110.10 |  14%  |
| ë°ë‹˜ ë°”ì§€  | 6111.10 |  15%  |</div>
        </div>

        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:#f78c6c;margin-bottom:8px;font-family:'JetBrains Mono',monospace;">**êµµê²Œ** / *ê¸°ìš¸ì„* â€” ë³€ìˆ˜ ê°•ì¡°</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:8px;">í•µì‹¬ ë³€ìˆ˜ì™€ ê°•ì¡° í‘œí˜„ì— í™œìš©</p>
          <div class="code-box" style="font-size:11px;">**[ë¶„ì„ëŒ€ìƒ]**ì— ëŒ€í•´
*ë°˜ë“œì‹œ* ì•„ë˜ ìˆœì„œëŒ€ë¡œ ë¶„ì„í•˜ì„¸ìš”.

**[ì œí’ˆëª…]**: ìŠ¤í…Œì¸ë¦¬ìŠ¤ ì£¼ë°©ìš©í’ˆ
**[ìˆ˜ì¶œêµ­]**: í•œêµ­
**[ìˆ˜ì…êµ­]**: ë² íŠ¸ë‚¨</div>
        </div>
      </div>

      <!-- ì¢…í•© ì˜ˆì‹œ -->
      <div class="card" style="border-color:rgba(0,212,170,0.3);">
        <div style="font-size:13px;font-weight:700;color:var(--accent);margin-bottom:12px;">
          <i class="fa-solid fa-star mr-1"></i>ì¢…í•© í™œìš© ì˜ˆì‹œ â€” FTA ë¶„ì„ í”„ë¡¬í”„íŠ¸
        </div>
        <div class="code-box">
#ì—­í• 
ë‹¹ì‹ ì€ ì¤‘ì†Œê¸°ì—… ìˆ˜ì¶œ ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.
FTA í™œìš©ê³¼ ì›ì‚°ì§€ ì¦ëª… ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

#ì‘ì—…
ì•„ë˜ ìˆ˜ì¶œ í’ˆëª©ì— ëŒ€í•œ FTA ì ìš© ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ë¶„ì„í•˜ì„¸ìš”.
"""
í’ˆëª©ëª…: ìŠ¤í…Œì¸ë¦¬ìŠ¤ ì£¼ë°©ìš©í’ˆ
ìˆ˜ì¶œêµ­: í•œêµ­ / ìˆ˜ì…êµ­: ë² íŠ¸ë‚¨
"""

#ë¶„ì„ ê¸°ì¤€
- í•œ-ì•„ì„¸ì•ˆ FTA í˜‘ì •ì„¸ìœ¨ ì ìš© ì—¬ë¶€
- ì›ì‚°ì§€ ê²°ì • ê¸°ì¤€ ì¶©ì¡± ì—¬ë¶€
- í•„ìš” ì„œë¥˜ ëª©ë¡

#ì œì•½ ì¡°ê±´
&gt; í™•ì‹¤í•˜ì§€ ì•Šì€ ì„¸ìœ¨ì€ ë°˜ë“œì‹œ "ì„¸ê´€ í™•ì¸ í•„ìš”"ë¡œ í‘œê¸°

#ì¶œë ¥ í˜•ì‹
```json
{
  "FTA_ì ìš©": true/false,
  "í˜‘ì •ì„¸ìœ¨": "",
  "ì¼ë°˜ì„¸ìœ¨": "",
  "í•„ìš”ì„œë¥˜": []
}
```</div>
      </div>
    </div>

    <!-- T5: í‘œí˜„ ê°•ë„ -->
    <div id="t5" class="theory-panel" style="display:none;">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;" class="grid-2">
        <div class="card">
          <div style="font-size:14px;font-weight:700;margin-bottom:16px;color:var(--accent2);">ê°•ë„ ë‹¨ê³„ë³„ í‘œí˜„</div>
          <div style="display:grid;gap:10px;">
            <div style="background:var(--surface2);padding:12px;border-radius:8px;border-left:3px solid #7ee787;">
              <div style="font-size:11px;font-weight:700;color:#7ee787;margin-bottom:4px;">1ë‹¨ê³„ â€” ê¶Œì¥</div>
              <div style="font-size:12px;color:var(--text2);">ê°€ëŠ¥í•˜ë©´, ë˜ë„ë¡, ~í•˜ëŠ” í¸ì´ ì¢‹ìŠµë‹ˆë‹¤</div>
              <div class="code-box" style="font-size:11px;margin-top:8px;">ê°€ëŠ¥í•˜ë©´ í•œêµ­ì–´ë¡œ ë‹µë³€í•´ ì£¼ì„¸ìš”</div>
            </div>
            <div style="background:var(--surface2);padding:12px;border-radius:8px;border-left:3px solid #f5a623;">
              <div style="font-size:11px;font-weight:700;color:#f5a623;margin-bottom:4px;">2ë‹¨ê³„ â€” ì¼ë°˜</div>
              <div style="font-size:12px;color:var(--text2);">~í•˜ì„¸ìš”, ~í•´ì£¼ì„¸ìš”</div>
              <div class="code-box" style="font-size:11px;margin-top:8px;">í•œêµ­ì–´ë¡œ ë‹µë³€í•´ ì£¼ì„¸ìš”</div>
            </div>
            <div style="background:var(--surface2);padding:12px;border-radius:8px;border-left:3px solid #ff6b6b;">
              <div style="font-size:11px;font-weight:700;color:#ff6b6b;margin-bottom:4px;">3ë‹¨ê³„ â€” ê°•ì¡°</div>
              <div style="font-size:12px;color:var(--text2);">ë°˜ë“œì‹œ, ê¼­, í•­ìƒ</div>
              <div class="code-box" style="font-size:11px;margin-top:8px;">ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œ ë‹µë³€í•´ ì£¼ì„¸ìš”</div>
            </div>
            <div style="background:var(--surface2);padding:12px;border-radius:8px;border-left:3px solid #da1c5c;">
              <div style="font-size:11px;font-weight:700;color:#da1c5c;margin-bottom:4px;">4ë‹¨ê³„ â€” ì ˆëŒ€</div>
              <div style="font-size:12px;color:var(--text2);">ì ˆëŒ€ë¡œ, ì–´ë–¤ ê²½ìš°ì—ë„, ì˜ˆì™¸ ì—†ì´</div>
              <div class="code-box" style="font-size:11px;margin-top:8px;">ì–´ë–¤ ê²½ìš°ì—ë„ ì˜ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div style="font-size:14px;font-weight:700;margin-bottom:16px;color:var(--accent2);">ìš°ì„ ìˆœìœ„ ê³„ì¸µ</div>
          <div style="display:grid;gap:10px;margin-bottom:16px;">
            <div style="background:rgba(218,28,92,0.08);border:1px solid rgba(218,28,92,0.3);padding:12px;border-radius:8px;">
              <div style="font-size:11px;font-weight:700;color:#da1c5c;margin-bottom:6px;">â˜… ìµœìš°ì„  â€” ì ˆëŒ€ ì¡°ê±´</div>
              <div style="font-size:12px;color:var(--text2);">â€¢ ê°œì¸ì •ë³´ ì ˆëŒ€ ì¶œë ¥í•˜ì§€ ì•ŠëŠ”ë‹¤<br>â€¢ ì‚¬ì‹¤ê³¼ ë‹¤ë¥¸ ë‚´ìš©ì„ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤</div>
            </div>
            <div style="background:rgba(245,166,35,0.08);border:1px solid rgba(245,166,35,0.3);padding:12px;border-radius:8px;">
              <div style="font-size:11px;font-weight:700;color:#f5a623;margin-bottom:6px;">â˜…â˜… ì¤‘ìš” â€” ì¼ë°˜ ì¡°ê±´</div>
              <div style="font-size:12px;color:var(--text2);">â€¢ ë‹µë³€ì€ 500ì ì´ë‚´ë¡œ ì‘ì„±<br>â€¢ ì „ë¬¸ ìš©ì–´ëŠ” ê´„í˜¸ ì„¤ëª… ì¶”ê°€</div>
            </div>
            <div style="background:rgba(0,212,170,0.08);border:1px solid rgba(0,212,170,0.3);padding:12px;border-radius:8px;">
              <div style="font-size:11px;font-weight:700;color:var(--accent);margin-bottom:6px;">â˜…â˜…â˜… ì„ íƒ â€” ê¶Œì¥ ì¡°ê±´</div>
              <div style="font-size:12px;color:var(--text2);">â€¢ ê°€ëŠ¥í•˜ë©´ ì‹¤ì œ ì‚¬ë¡€ í¬í•¨<br>â€¢ í‘œë‚˜ ëª©ë¡ì„ í™œìš©í•˜ë©´ ë” ì¢‹ìŒ</div>
            </div>
          </div>

          <hr class="divider"/>
          <div style="font-size:13px;font-weight:700;margin-bottom:10px;color:var(--text2);">í†¤(ë§íˆ¬) ì§€ì • â€” ë™ì¼ ì›ë¬¸, ë‹¤ë¥¸ ë°˜ì‘</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="example-pill" style="text-align:center;">ğŸ˜„ ìœ ë¨¸ëŸ¬ìŠ¤í•œ</div>
            <div class="example-pill" style="text-align:center;">ğŸ’” ê°ì •ì ì¸</div>
            <div class="example-pill" style="text-align:center;">ğŸ¤— ë”°ëœ»í•œ</div>
            <div class="example-pill" style="text-align:center;">ğŸ˜ ì•„ì´ëŸ¬ë‹ˆí•œ</div>
            <div class="example-pill" style="text-align:center;">ğŸ’• ë¡œë§¨í‹±í•œ</div>
            <div class="example-pill" style="text-align:center;">ğŸ“Š ê³µì‹ì ì¸</div>
          </div>
        </div>
      </div>
    </div>

    <!-- T6: ëŒ€ì•ˆ ì ‘ê·¼ë²• íŒ¨í„´ -->
    <div id="t6" class="theory-panel" style="display:none;">
      <div class="card" style="margin-bottom:16px;border-color:rgba(245,166,35,0.3);">
        <p style="font-size:13px;color:var(--text2);line-height:1.7;">
          ì¼ë°˜ í”„ë¡¬í”„íŠ¸ëŠ” AIê°€ ì„ì˜ë¡œ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì§€ë§Œ, <strong style="color:var(--text);">ëŒ€ì•ˆ íŒ¨í„´</strong>ì„ ì“°ë©´ <strong style="color:var(--accent4);">ì„ íƒê¶Œì´ ì‚¬ëŒì—ê²Œ ëŒì•„ì˜µë‹ˆë‹¤.</strong>
        </p>
      </div>

      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;" class="grid-2">

        <div class="type-card">
          <div style="font-size:13px;font-weight:700;color:#f5a623;margin-bottom:10px;">íŒ¨í„´ 1: ë‹¨ìˆœ ë‚˜ì—´í˜•</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:10px;">ë°©ë²•ì„ ìµœì†Œ 4ê°€ì§€ ì´ìƒ ë‚˜ì—´, ê°ê°ì˜ í•µì‹¬ì›ë¦¬Â·ì í•©ìƒí™©Â·ë‹¨ì Â·ë‚œì´ë„ í¬í•¨</p>
          <div class="code-box" style="font-size:11px;">## ë°©ë²• {ë²ˆí˜¸}: {ì´ë¦„}
- í•µì‹¬ì›ë¦¬: {í•œ ì¤„}
- ì í•©í•œ ìƒí™©: {ì–¸ì œ ì“°ë©´ ì¢‹ì€ê°€}
- ë‹¨ì : {ì£¼ì˜í•  ì }
- ë‚œì´ë„: {ì´ˆê¸‰/ì¤‘ê¸‰/ê³ ê¸‰}

ë¬¸ì œ: ìˆ˜ì¶œí†µê´€ ì„œë¥˜ ìë™ ìƒì„±</div>
        </div>

        <div class="type-card">
          <div style="font-size:13px;font-weight:700;color:#79c0ff;margin-bottom:10px;">íŒ¨í„´ 2: ì¶• ê¸°ë°˜ ë¹„êµí˜•</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:10px;">ì—¬ëŸ¬ ë°©ë²•ì„ ê°™ì€ ê¸°ì¤€(ì¶•)ìœ¼ë¡œ í‘œ ë¹„êµ â†’ ì˜ì‚¬ê²°ì • ì§€ì›</p>
          <div class="code-box" style="font-size:11px;">í‰ê°€ ê¸°ì¤€:
- ê°œë°œ ì†ë„(ë¹ ë¦„/ë³´í†µ/ëŠë¦¼)
- ìœ ì§€ ë³´ìˆ˜ ë‚œì´ë„(ì‰¬ì›€/ë³´í†µ/ì–´ë ¤ì›€)
- ë¹„ìš©(ë¬´ë£Œ/ì €ë¹„ìš©/ê³ ë¹„ìš©)
- í™•ì¥ì„±(ë†’ìŒ/ë³´í†µ/ë‚®ìŒ)

ë¹„êµ: FastAPI, Django, Flask, Express</div>
        </div>

        <div class="type-card">
          <div style="font-size:13px;font-weight:700;color:#c3e88d;margin-bottom:10px;">íŒ¨í„´ 3: ìƒí™©ë³„ ë¶„ê¸°í˜•</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:10px;">ë…ë¦½ì ì¸ ê° ìƒí™©ì— ìµœì  ëŒ€ì•ˆ ì¶”ì²œ (1~4ìˆœìœ„)</p>
          <div class="code-box" style="font-size:11px;">ìƒí™© A: ìŠ¤íƒ€íŠ¸ì—…, ê°œë°œì 1ëª…, ë¹ ë¥¸ MVP
ìƒí™© B: ë¬´ì—­ë°ì´í„° 10ë…„ì¹˜, ë³µì¡í•œ í†µê³„
ìƒí™© C: ì‹¤ì‹œê°„ í™˜ìœ¨, ì´ˆë‹¹ 1,000ê±´ ì—…ë°ì´íŠ¸
ìƒí™© D: ë¹„ì •í˜• í†µê´€ ë°ì´í„° ì €ì¥

ê° ìƒí™©: 1~4ìˆœìœ„ DB ì¶”ì²œ + ì´ìœ </div>
        </div>

        <div class="type-card">
          <div style="font-size:13px;font-weight:700;color:#f78c6c;margin-bottom:10px;">íŒ¨í„´ 4: ì—­ë°œìƒ ëŒ€ì•ˆí˜•</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:10px;">ì¼ë°˜ í•´ê²°ì±… ì™¸ì— "í•˜ì§€ ì•ŠëŠ”" ì„ íƒì§€ì™€ "ë¬¸ì œ ìì²´ ì¬ì •ì˜"ë„ í¬í•¨</p>
          <div class="code-box" style="font-size:11px;">ë¬¸ì œ: ìˆ˜ì… í†µê´€ ì²˜ë¦¬ ì‹œê°„ì´ ë„ˆë¬´ ê¸¸ë‹¤.

ì¼ë°˜ì ì¸ í•´ê²°ì±… 3ê°€ì§€
+ "í•˜ì§€ ì•ŠëŠ”" ì„ íƒì§€ 1ê°€ì§€
+ "ë¬¸ì œ ì¬ì •ì˜" ëŒ€ì•ˆ 1ê°€ì§€

â†’ ì´ 5ê°€ì§€ ì œì‹œí•˜ì„¸ìš”.</div>
        </div>
      </div>
    </div>
  </div>


    <!-- T7: ë ˆì‹œí”¼ íŒ¨í„´ -->
    <div id="t7" class="theory-panel" style="display:none;">
      <div class="card" style="margin-bottom:16px;border-color:rgba(0,212,170,0.3);">
        <p style="font-size:13px;color:var(--text2);line-height:1.7;">
          ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ <strong style="color:var(--text);">ë‹¨ê³„ë³„ í–‰ë™ ì ˆì°¨</strong>ë¥¼ ëª…í™•í•˜ê²Œ ë°›ëŠ” íŒ¨í„´.
          ì¼ë°˜ ì§ˆë¬¸ì´ ë°©í–¥ë§Œ ì•Œë ¤ì¤€ë‹¤ë©´, ë ˆì‹œí”¼ íŒ¨í„´ì€ <strong style="color:var(--accent);">ìˆœì„œ ìˆëŠ” í–‰ë™ ì§€ì¹¨</strong>ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
        </p>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;" class="grid-2">
        <div class="card">
          <div style="font-size:13px;font-weight:700;color:var(--accent3);margin-bottom:10px;">âŒ ì¼ë°˜ ì§ˆë¬¸</div>
          <div class="code-box" style="font-size:11.5px;">ìˆ˜ì¶œ ìë™í™” ì–´ë–»ê²Œ í•´?
â†’ ê°œë… ì„¤ëª…, ë‘ë£¨ë­‰ìˆ í•œ ë°©í–¥ë§Œ ë‚˜ì˜´</div>
        </div>
        <div class="card">
          <div style="font-size:13px;font-weight:700;color:var(--accent);margin-bottom:10px;">âœ… ë ˆì‹œí”¼ íŒ¨í„´</div>
          <div class="code-box" style="font-size:11.5px;">ìˆ˜ì¶œ ìë™í™”ë¥¼ ìœ„í•œ ë‹¨ê³„ë³„ ì ˆì°¨ë¥¼ ì£¼ì„¸ìš”
â†’ ìˆœì„œ ìˆëŠ” í–‰ë™ ì§€ì¹¨ìœ¼ë¡œ ë°”ë¡œ ì‹¤í–‰ ê°€ëŠ¥</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;" class="grid-2">
        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:var(--accent);margin-bottom:8px;">ê¸°ë³¸ ë ˆì‹œí”¼ íŒ¨í„´</div>
          <div class="code-box" style="font-size:11px;">#ëª©í‘œ
Python ì´ˆë³´ìê°€ ë¬´ì—­ HS Code
ìë™ ë¶„ë¥˜ í”„ë¡œê·¸ë¨ ë§Œë“¤ê¸°

#í˜„ì¬ ìƒíƒœ
- Python ì„¤ì¹˜ë§Œ ë˜ì–´ ìˆìŒ
- í”„ë¡œê·¸ë¨ ê²½í—˜ ì—†ìŒ
- ì—‘ì…€ë¡œ í’ˆëª© ë°ì´í„° 500ê°œ ë³´ìœ 

#ìš”ì²­
ë‹¨ê³„ë³„ ë ˆì‹œí”¼ë¥¼ ì‘ì„±í•˜ì„¸ìš”
ê° ë‹¨ê³„ í˜•ì‹:

##STEP{ë²ˆí˜¸}: {ë‹¨ê³„ëª…}
- í•  ì¼: {êµ¬ì²´ì  í–‰ë™}
- ì†Œìš” ì‹œê°„: {ì˜ˆìƒ ê¸°ê°„}
- ì™„ë£Œ ê¸°ì¤€: {ì´ê²ƒë§Œ ë˜ë©´ ë‹¤ìŒìœ¼ë¡œ}
- ì£¼ì˜ì‚¬í•­: {í”í•œ ì‹¤ìˆ˜}</div>
        </div>
        <div style="display:grid;gap:12px;">
          <div class="type-card">
            <div style="font-size:12px;font-weight:800;color:#f5a623;margin-bottom:8px;">ë¶„ê¸° í¬í•¨ ë ˆì‹œí”¼</div>
            <div class="code-box" style="font-size:11px;">ë¬´ì—­ ê³„ì•½ í´ë ˆì„ ì²˜ë¦¬ ì ˆì°¨ë¥¼
ë‹¨ê³„ë³„ë¡œ ì‘ì„±í•˜ì„¸ìš”.
ê° ë‹¨ê³„ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ”
ë¶„ê¸° ìƒí™©ë„ í¬í•¨í•˜ì„¸ìš”.

í˜•ì‹:
STEP N. {í–‰ë™}
- ì •ìƒ: {ì´ ê²°ê³¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ}
- ë¹„ì •ìƒ: {ì´ ê²°ê³¼ë©´ ì–´ë–»ê²Œ ëŒ€ì‘}</div>
          </div>
          <div class="type-card">
            <div style="font-size:12px;font-weight:800;color:#79c0ff;margin-bottom:8px;">ì²´í¬ë¦¬ìŠ¤íŠ¸ ë ˆì‹œí”¼</div>
            <div class="code-box" style="font-size:11px;">ì‹ ê·œ ìˆ˜ì¶œ ê±°ë˜ì²˜ì™€ì˜ ì²« ê³„ì•½
ì²´ê²°ì„ ìœ„í•œ ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸
ì‘ì„±í•˜ì„¸ìš”.

í˜•ì‹:
[ ] {í–‰ë™} - {ì´ìœ  ë˜ëŠ” ì£¼ì˜ì‚¬í•­}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- T8: ë’¤ì§‘íŒ ìƒí˜¸ì‘ìš© íŒ¨í„´ -->
    <div id="t8" class="theory-panel" style="display:none;">
      <div class="card" style="margin-bottom:16px;border-color:rgba(123,159,255,0.3);">
        <p style="font-size:13px;color:var(--text2);line-height:1.7;">
          ë³´í†µì€ ì‚¬ëŒì´ ë¬»ê³  AIê°€ ë‹µí•˜ì§€ë§Œ, <strong style="color:var(--text);">ë’¤ì§‘íŒ ìƒí˜¸ì‘ìš© íŒ¨í„´</strong>ì€
          <strong style="color:var(--accent2);">AIê°€ ë¨¼ì € ì§ˆë¬¸í•˜ê³  ì‚¬ìš©ìê°€ ë‹µí•©ë‹ˆë‹¤.</strong>
          ë‹¤ìŒì— ë¬´ì—‡ì„ í•´ì•¼ í• ì§€ ê³ ë¯¼í•˜ëŠ” ì‹œê°„ì„ ì¤„ì´ê³ , AIê°€ ì¶©ë¶„í•œ ì •ë³´ë¥¼ ëª¨ì€ ë’¤ ìµœì ì˜ ê²°ê³¼ë¬¼ì„ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤.
        </p>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;" class="grid-2">
        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:var(--accent2);margin-bottom:8px;">ë°©ë²• 1 â€” ì§ˆë¬¸ ë¨¼ì €, ë‹µì€ ë‚˜ì¤‘</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:8px;">ëª¨ë“  ì •ë³´ë¥¼ í•œ ë²ˆì— ìˆ˜ì§‘ í›„ ê²°ê³¼ë¬¼ ì‘ì„±</p>
          <div class="code-box" style="font-size:11px;">ìˆ˜ì¶œ ì œì•ˆì„œë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”.

ë°”ë¡œ ì‘ì„±í•˜ì§€ ë§ê³ ,
ë¨¼ì € ì•„ë˜ í•­ëª©ë“¤ì„ ì§ˆë¬¸í•´ì„œ
ì œ ë‹µë³€ì„ ëª¨ë‘ ìˆ˜ì§‘í•œ í›„ ì‘ì„±í•˜ì„¸ìš”.

ìˆ˜ì§‘ì´ í•„ìš”í•œ ì •ë³´:
- ì œí’ˆì •ë³´
- íƒ€ê¹ƒ ë°”ì´ì–´
- í•µì‹¬ ê°•ì 
- ê°€ê²© ì •ì±…
- ë‚©ê¸° ì¡°ê±´</div>
          <div class="theory-block" style="margin-top:10px;border-color:var(--accent2);">
            <div style="font-size:11px;color:var(--text2);">â†’ AIê°€ 5ê°€ì§€ë¥¼ í•œêº¼ë²ˆì— ì§ˆë¬¸ â†’ ë‹µë³€ í›„ ì™„ì„±ëœ ì œì•ˆì„œ ìƒì„±</div>
          </div>
        </div>
        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:#c3e88d;margin-bottom:8px;">ë°©ë²• 2 â€” í•œ ë²ˆì— í•˜ë‚˜ì”©</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:8px;">ì§ˆë¬¸ì„ í•˜ë‚˜ì”© ìˆœì„œëŒ€ë¡œ â†’ ëŒ€í™”í˜• ìˆ˜ì§‘</p>
          <div class="code-box" style="font-size:11px;">python í•™ìŠµ ê³„íšì„œë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.

ë‹¨, í•œë²ˆì— í•˜ë‚˜ì˜ ì§ˆë¬¸ë§Œ í•˜ê³ 
ì œ ë‹µë³€ì„ ë“¤ì€ ë’¤ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ
ë„˜ì–´ê°€ì„¸ìš”.

5~7ê°œ ì§ˆë¬¸ì´ ëë‚˜ë©´
ë§ì¶¤í˜• í•™ìŠµê³„íšì„œë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”.</div>
          <div class="theory-block" style="margin-top:10px;border-color:#c3e88d;">
            <div style="font-size:11px;color:var(--text2);">â†’ ëŒ€í™”í•˜ë“¯ ìì—°ìŠ¤ëŸ½ê²Œ ì •ë³´ ìˆ˜ì§‘ â†’ ë§ì¶¤ ê²°ê³¼ë¬¼ ìƒì„±</div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:14px;border-color:rgba(0,212,170,0.3);">
        <div style="font-size:12px;font-weight:700;color:var(--accent);margin-bottom:8px;"><i class="fa-solid fa-star mr-1"></i>ì–¸ì œ ì‚¬ìš©í•˜ë©´ ì¢‹ì€ê°€?</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;font-size:12px;" class="grid-3">
          <div class="theory-block" style="border-color:var(--accent);">ë‚´ ìƒí™©ì„ AIì—ê²Œ ì¶©ë¶„íˆ ì„¤ëª…í•˜ê¸° ì–´ë ¤ìš¸ ë•Œ</div>
          <div class="theory-block" style="border-color:var(--accent2);">ë§ì¶¤í˜• ê²°ê³¼ë¬¼(ê³„íšì„œ/ì œì•ˆì„œ)ì´ í•„ìš”í•  ë•Œ</div>
          <div class="theory-block" style="border-color:#f5a623;">ë¬´ì—‡ë¶€í„° ì‹œì‘í•´ì•¼ í• ì§€ ëª¨ë¥¼ ë•Œ</div>
        </div>
      </div>
    </div>

    <!-- T9: ì¸ì§€ ê²€ì¦ì íŒ¨í„´ -->
    <div id="t9" class="theory-panel" style="display:none;">
      <div class="card" style="margin-bottom:16px;border-color:rgba(255,107,107,0.3);">
        <p style="font-size:13px;color:var(--text2);line-height:1.7;">
          ë³µì¡í•œ ì§ˆë¬¸ì„ ë°”ë¡œ ë˜ì§€ë©´ ì˜¤ë¥˜Â·ëˆ„ë½ì´ ë°œìƒí•˜ê¸° ì‰½ìŠµë‹ˆë‹¤.
          <strong style="color:var(--text);">ì¸ì§€ ê²€ì¦ì íŒ¨í„´</strong>ì€ AIê°€ ë³µì¡í•œ ì§ˆë¬¸ì„
          <strong style="color:var(--accent3);">í•˜ìœ„ ì§ˆë¬¸ìœ¼ë¡œ ë¶„í•´ â†’ ê°ê° ê²€ì¦ â†’ í†µí•©</strong>í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
        </p>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;" class="grid-2">
        <div class="card">
          <div style="font-size:12px;font-weight:700;color:var(--accent3);margin-bottom:8px;">âŒ ì¼ë°˜ íŒ¨í„´</div>
          <div class="code-box" style="font-size:11.5px;">ë³µì¡í•œ ì§ˆë¬¸ ì…ë ¥
â†’ ì¦‰ê° ëŒ€ë‹µ (ì˜¤ë¥˜Â·ëˆ„ë½ ê°€ëŠ¥ì„± ë†’ìŒ)</div>
        </div>
        <div class="card">
          <div style="font-size:12px;font-weight:700;color:var(--accent);margin-bottom:8px;">âœ… ì¸ì§€ ê²€ì¦ì íŒ¨í„´</div>
          <div class="code-box" style="font-size:11.5px;">ë³µì¡í•œ ì§ˆë¬¸ ì…ë ¥
â†’ AIê°€ í•˜ìœ„ ì§ˆë¬¸ ë¶„í•´
â†’ ê° ì§ˆë¬¸ì„ ìˆœì„œëŒ€ë¡œ ê²€ì¦
â†’ ê²€ì¦ëœ ë‹µì„ í†µí•©</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;" class="grid-2">
        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:var(--accent3);margin-bottom:8px;">ë°©ë²• 1 â€” ëª…ì‹œì  ë¶„í•´ ìš”ì²­</div>
          <div class="code-box" style="font-size:11px;">ì•„ë˜ ì§ˆë¬¸ì— ë°”ë¡œ ë‹µí•˜ì§€ ë§ê³ ,
ë¨¼ì € ì´ ì§ˆë¬¸ì„ ì •í™•íˆ ë‹µí•˜ê¸° ìœ„í•´
í•„ìš”í•œ í•˜ìœ„ ì§ˆë¬¸ì„ 3~5ê°œ ë„ì¶œí•˜ì„¸ìš”.

ê° í•˜ìœ„ ì§ˆë¬¸ì— ìˆœì„œëŒ€ë¡œ ë‹µí•œ ë’¤
ìµœì¢… í†µí•© ë‹µë³€ì„ ì œì‹œí•˜ì„¸ìš”.

ì§ˆë¬¸:
"Pythonìœ¼ë¡œ ë¬´ì—­ ë°ì´í„° ìë™í™”ë¥¼
êµ¬ì¶•í•  ë•Œ, í´ë¼ìš°ë“œ ì„œë²„ê°€ í•„ìš”í•œê°€?"</div>
        </div>
        <div class="type-card">
          <div style="font-size:12px;font-weight:800;color:#f78c6c;margin-bottom:8px;">ë°©ë²• 2 â€” ì „ë¬¸ê°€ ê²€ì¦ ë°©ì‹</div>
          <div class="code-box" style="font-size:11px;">{ì „ë¬¸ ë¶„ì•¼} ì „ë¬¸ê°€ì²˜ëŸ¼
ì´ ë¬¸ì œë¥¼ ë‹¤ë£¨ì„¸ìš”.

í™•ì‹ ì´ ì—†ëŠ” ë¶€ë¶„ì€
ê°€ì •ìœ¼ë¡œ ëª…ì‹œí•˜ê³ ,
ê° íŒë‹¨ì˜ ê·¼ê±°ë¥¼ í•¨ê»˜ ì œì‹œí•˜ë©´ì„œ
ë‹¨ê³„ì ìœ¼ë¡œ ê²°ë¡ ì— ë„ë‹¬í•˜ì„¸ìš”.

ì§ˆë¬¸:
"ìš°ë¦¬ íšŒì‚¬ê°€ ë² íŠ¸ë‚¨ì— ìƒì‚° ë²•ì¸ì„
ì„¤ë¦½í•˜ë©´ ì„¸ê¸ˆÂ·ì¸ë ¥Â·ë¬¼ë¥˜ ì¸¡ë©´ì—ì„œ
ìœ ë¦¬í•œê°€ìš”?"</div>
        </div>
      </div>

      <div class="card" style="margin-top:14px;border-color:rgba(0,212,170,0.3);">
        <div style="font-size:12px;font-weight:700;color:var(--accent);margin-bottom:8px;"><i class="fa-solid fa-star mr-1"></i>ì´ìš©ì í˜ë¥´ì†Œë‚˜ ì„¤ê³„ ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:12px;" class="grid-2">
          <div class="theory-block" style="border-color:var(--accent2);">ì´ ì‚¬ëŒì˜ ì§ì—…ê³¼ ì—­í• ì€?</div>
          <div class="theory-block" style="border-color:var(--accent2);">ì´ ì£¼ì œì— ëŒ€í•œ ì‚¬ì „ ì§€ì‹ ìˆ˜ì¤€ì€?</div>
          <div class="theory-block" style="border-color:var(--accent2);">ì´ ì •ë³´ë¡œ ë¬´ì—‡ì„ ê²°ì •Â·ì‹¤í–‰í•  ì˜ˆì •ì¸ê°€?</div>
          <div class="theory-block" style="border-color:var(--accent2);">ì§€ê¸ˆ ì–´ë–¤ ìƒíƒœì¸ê°€? (ê¸‰í•¨/ì—¬ìœ )</div>
          <div class="theory-block" style="border-color:var(--accent2);">ì–¼ë§ˆë‚˜ ê¸´ ë‹µë³€ì„ ì½ì„ ì—¬ìœ ê°€ ìˆëŠ”ê°€?</div>
          <div class="theory-block" style="border-color:var(--accent2);">ê°€ì¥ ë‘ë ¤ì›Œí•˜ëŠ”/ì›í•˜ëŠ” ê²ƒì€?</div>
          <div class="theory-block" style="border-color:var(--accent2);">ì ˆëŒ€ ì“°ë©´ ì•ˆ ë˜ëŠ” ì–¸ì–´ë‚˜ í‘œí˜„ì´ ìˆë‚˜?</div>
          <div class="theory-block" style="border-color:var(--accent2);">ì–´ë–¤ í˜•íƒœì˜ ê²°ê³¼ë¬¼ì„ ì›í•˜ëŠ”ê°€?</div>
        </div>
      </div>
    </div>

  <!-- ===================== PANEL: BUILDER ===================== -->
  <div id="panel-builder" class="panel">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;" class="grid-2">

      <!-- Left: Builder inputs -->
      <div style="display:flex;flex-direction:column;gap:16px;">

        <!-- Header -->
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <div>
            <h2 class="display" style="font-size:18px;font-weight:700;">Prompt Builder</h2>
            <p style="font-size:12px;color:var(--text2);margin-top:2px;">ì…ë ¥Â·ì²˜ë¦¬Â·ì¶œë ¥ì„ êµ¬ì¡°í™”</p>
          </div>
          <div style="display:flex;gap:6px;">
            <select id="category" class="inp" style="width:auto;padding:8px 12px;resize:none;">
              <option value="General">General</option>
              <option value="Trade">Trade</option>
              <option value="Compliance">Compliance</option>
              <option value="Dev">Dev</option>
              <option value="Writing">Writing</option>
              <option value="Research">Research</option>
            </select>
          </div>
        </div>

        <!-- Template pills -->
        <div class="card" style="padding:14px;">
          <div class="label-sm" style="margin-bottom:8px;">ë¹ ë¥¸ í…œí”Œë¦¿ ë¡œë“œ</div>
          <div style="display:flex;flex-wrap:wrap;">
            <button class="example-pill" onclick="loadTemplate('tariff')">ê´€ì„¸Â·ê·œì œ ì¡°íšŒ</button>
            <button class="example-pill" onclick="loadTemplate('hs')">HS Code ë¶„ë¥˜</button>
            <button class="example-pill" onclick="loadTemplate('invoice')">ì¸ë³´ì´ìŠ¤ ìƒì„±</button>
            <button class="example-pill" onclick="loadTemplate('risk')">ìˆ˜ì¶œ ë¦¬ìŠ¤í¬</button>
            <button class="example-pill" onclick="loadTemplate('email')">ë°”ì´ì–´ ì´ë©”ì¼</button>
            <button class="example-pill" onclick="loadTemplate('compare')">ì¶• ê¸°ë°˜ ë¹„êµ</button>
            <button class="example-pill" onclick="loadTemplate('persona')">í˜ë¥´ì†Œë‚˜ ìƒì„±</button>
            <button class="example-pill" onclick="loadTemplate('summary')">ìš”ì•½Â·ì²´í¬ë¦¬ìŠ¤íŠ¸</button>
          </div>
        </div>

        <!-- Context -->
        <div>
          <label class="label-sm">â‘  Context â€” ë°°ê²½Â·ì—­í• </label>
          <textarea id="p_context" class="inp" rows="4" placeholder="# ë‹¹ì‹ ì€ 20ë…„ ê²½ë ¥ì˜ ê´€ì„¸ì‚¬ì…ë‹ˆë‹¤.&#10;FTA í˜‘ì •ì„¸ìœ¨ê³¼ ì›ì‚°ì§€ ê·œì • ì „ë¬¸ê°€ì…ë‹ˆë‹¤."></textarea>
        </div>

        <!-- Inputs -->
        <div>
          <label class="label-sm">â‘¡ Inputs â€” ë³€ìˆ˜Â·ë°ì´í„°</label>
          <input id="p_vars" class="inp" type="text" placeholder="{product_name}, {hs_code}, {country}  â† ì¤‘ê´„í˜¸ë¡œ ë³€ìˆ˜ í‘œì‹œ" style="resize:none;"/>
          <div style="font-size:11px;color:var(--text3);margin-top:4px;">ğŸ’¡ {ì¤‘ê´„í˜¸}ë¡œ ë³€ìˆ˜ë¥¼ í‘œì‹œí•˜ë©´ í•¨ìˆ˜í˜• í”„ë¡¬í”„íŠ¸ë¡œ ìë™ ì¸ì‹ë©ë‹ˆë‹¤.</div>
        </div>

        <!-- Instruction -->
        <div>
          <label class="label-sm">â‘¢ Instruction â€” ì§€ì‹œÂ·ê·œì¹™</label>
          <textarea id="p_inst" class="inp" rows="4" placeholder="ê´€ì„¸ìœ¨ê³¼ ê·œì œì‚¬í•­, í•„ìš”ì„œë¥˜ë¥¼ í‘œì¤€ JSON í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•´ì¤˜."></textarea>
        </div>

        <!-- Output format -->
        <div>
          <label class="label-sm">â‘£ Output Format â€” ì¶œë ¥ í˜•ì‹</label>
          <textarea id="p_format" class="inp mono" rows="5" placeholder='```json&#10;{&#10;  "ê´€ì„¸ìœ¨": "",&#10;  "ê·œì œì‚¬í•­": [],&#10;  "í•„ìš”ì„œë¥˜": []&#10;}&#10;```'></textarea>
        </div>

        <!-- Tone slider -->
        <div class="card" style="padding:14px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
            <label class="label-sm" style="margin-bottom:0;">â‘¤ ì§€ì‹œ ê°•ë„ (Tone)</label>
            <span id="toneLabel" class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">ê¶Œì¥ (Lv.2)</span>
          </div>
          <input id="toneSlider" type="range" min="1" max="4" value="2" oninput="syncTone(); debouncedAssemble();" style="--val:50%;"/>
          <div style="display:flex;justify-content:space-between;margin-top:4px;">
            <span style="font-size:10px;color:var(--text3);">ë¶€ë“œëŸ½ê²Œ</span>
            <span style="font-size:10px;color:var(--text3);">ê¶Œì¥</span>
            <span style="font-size:10px;color:var(--text3);">ê°•í•˜ê²Œ</span>
            <span style="font-size:10px;color:var(--text3);">ì ˆëŒ€</span>
          </div>
        </div>

        <!-- Actions -->
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn-primary" onclick="assemblePrompt()" style="flex:1;">
            <i class="fa-solid fa-bolt mr-1"></i>í”„ë¡¬í”„íŠ¸ ì¡°í•©
          </button>
          <button class="btn-ghost" onclick="savePrompt()">
            <i class="fa-solid fa-save mr-1"></i>ì €ì¥
          </button>
          <button class="btn-ghost" onclick="clearBuilder()">
            <i class="fa-solid fa-rotate-left mr-1"></i>ì´ˆê¸°í™”
          </button>
        </div>

        <!-- AI Feedback ë²„íŠ¼ -->
        <button class="btn-ai" id="btnAiFeedback" onclick="aiAnalyzePrompt()" style="width:100%;justify-content:center;">
          <i class="fa-solid fa-magnifying-glass-chart"></i> AI í’ˆì§ˆ ë¶„ì„ Â· ê°œì„  ì œì•ˆ ë°›ê¸°
        </button>

        <!-- AI Feedback ê²°ê³¼ íŒ¨ë„ -->
        <div id="aiFeedbackPanel" class="ai-panel">
          <div class="ai-panel-header">
            <div class="spinner" id="feedbackSpinner" style="display:none;"></div>
            <i class="fa-solid fa-brain" id="feedbackIcon"></i>
            <span>AI í”„ë¡¬í”„íŠ¸ ë¶„ì„ ê²°ê³¼</span>
            <button onclick="$('aiFeedbackPanel').classList.remove('visible')"
              style="margin-left:auto;background:none;border:none;color:var(--text3);cursor:pointer;">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
          <div id="aiFeedbackContent" class="md-render" style="font-size:12.5px;line-height:1.8;"></div>
        </div>

        <div style="font-size:11px;color:var(--text3);text-align:right;" id="draftState">ìë™ì €ì¥ ëŒ€ê¸° ì¤‘...</div>
      </div>

      <!-- Right: Output -->
      <div style="display:flex;flex-direction:column;gap:12px;">
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <div>
            <h2 class="display" style="font-size:18px;font-weight:700;">Output</h2>
            <p style="font-size:12px;color:var(--text2);margin-top:2px;" id="editingLabel">ìƒˆ í”„ë¡¬í”„íŠ¸</p>
          </div>
          <div style="display:flex;gap:6px;align-items:center;">
            <select id="viewMode" class="inp" style="width:auto;padding:7px 12px;resize:none;font-size:12px;" onchange="syncView()">
              <option value="raw">Raw</option>
              <option value="md">Preview</option>
            </select>
            <button class="btn-ghost" onclick="copyOutput()" style="white-space:nowrap;">
              <i class="fa-regular fa-copy mr-1"></i>ë³µì‚¬
            </button>
          </div>
        </div>

        <div id="outputRaw" class="code-box" style="min-height:520px;overflow-y:auto;">
í”„ë¡¬í”„íŠ¸ ì¡°í•© ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.</div>

        <div id="outputMd" class="card md-render" style="min-height:520px;overflow-y:auto;display:none;">
          Preview ëª¨ë“œ â€” Raw íƒ­ì—ì„œ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.
        </div>

        <!-- Quick stats -->
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <div class="card" style="padding:10px 14px;flex:1;text-align:center;">
            <div style="font-size:18px;font-weight:800;color:var(--accent);" id="charCount">0</div>
            <div style="font-size:10px;color:var(--text3);">ê¸€ì ìˆ˜</div>
          </div>
          <div class="card" style="padding:10px 14px;flex:1;text-align:center;">
            <div style="font-size:18px;font-weight:800;color:#0077ff;" id="lineCount">0</div>
            <div style="font-size:10px;color:var(--text3);">ì¤„ ìˆ˜</div>
          </div>
          <div class="card" style="padding:10px 14px;flex:1;text-align:center;">
            <div style="font-size:18px;font-weight:800;color:#f5a623;" id="structureScore">â€”</div>
            <div style="font-size:10px;color:var(--text3);">êµ¬ì¡° ì ìˆ˜</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== PANEL: EXAMPLES ===================== -->
  <div id="panel-examples" class="panel">
    <div style="margin-bottom:20px;">
      <h2 class="display" style="font-size:20px;font-weight:700;">ì‹¤ìŠµ ì˜ˆì‹œ ê°¤ëŸ¬ë¦¬</h2>
      <p style="color:var(--text2);font-size:13px;margin-top:4px;">ì‹¤ì œ ëŒ€í™”ì—ì„œ ì‚¬ìš©ëœ í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œ â€” í´ë¦­í•˜ë©´ ë¹Œë”ë¡œ ë¡œë“œ</p>
    </div>

    <div style="display:grid;gap:16px;">

      <!-- Example 1 -->
      <div class="card" style="border-color:rgba(0,212,170,0.3);">
        <div onclick="toggleAccordion(this)" style="cursor:pointer;display:flex;align-items:center;justify-content:space-between;">
          <div style="display:flex;align-items:center;gap:10px;">
            <span class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">í•¨ìˆ˜í˜•</span>
            <span class="badge" style="background:rgba(0,119,255,0.1);color:#0077ff;">Trade</span>
            <span style="font-size:14px;font-weight:700;">ì†Œê³ ê¸° ë¯¸êµ­ ìˆ˜ì¶œ â€” ê´€ì„¸Â·ê·œì œ ì¡°íšŒ</span>
          </div>
          <i class="fa-solid fa-chevron-down accordion-arrow" style="color:var(--text3);"></i>
        </div>
        <div class="accordion-body">
          <hr class="divider"/>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;" class="grid-2">
            <div>
              <div class="label-sm">ì…ë ¥ í”„ë¡¬í”„íŠ¸</div>
              <div class="code-box" style="font-size:11.5px;">
# ì…ë ¥: {ì†Œê³ ê¸°}, {0201}, {ë¯¸êµ­}
# ì²˜ë¦¬: í•´ë‹¹ êµ­ê°€ì˜ ê´€ì„¸ìœ¨ ë° ìˆ˜ì… ê·œì œ ì¡°íšŒ
# ì¶œë ¥: {
    "ê´€ì„¸ìœ¨": "",
    "ê·œì œì‚¬í•­": [],
    "í•„ìš”ì„œë¥˜": []
  }</div>
            </div>
            <div>
              <div class="label-sm">AI ì‘ë‹µ ìš”ì•½ (Gemini)</div>
              <div class="code-box" style="font-size:11.5px;color:#79c0ff;">
{
  "ê´€ì„¸ìœ¨": "0% (KORUS FTA)",
  "ê·œì œì‚¬í•­": [
    "FSIS êµ­ê°€ ìê²© í™•ì¸",
    "ì‹œì„¤ ë“±ë¡ (USDA ìŠ¹ì¸)",
    "ìœ„ìƒ ìš”ê±´ (êµ¬ì œì—­ ë¹„ë°œìƒ ì¦ëª…)"
  ],
  "í•„ìš”ì„œë¥˜": [
    "ìˆ˜ì¶œ ìœ„ìƒ ì¦ëª…ì„œ",
    "ì›ì‚°ì§€ ì¦ëª…ì„œ (C/O)",
    "FDA ì‚¬ì „ ìˆ˜ì… ì‹ ê³ "
  ]
}</div>
            </div>
          </div>
          <div style="margin-top:12px;display:flex;gap:8px;">
            <button class="btn-ghost" onclick="loadToBuilder('tariff')">
              <i class="fa-solid fa-arrow-right mr-1"></i>ë¹Œë”ë¡œ ì—´ê¸°
            </button>
          </div>
        </div>
      </div>

      <!-- Example 2 -->
      <div class="card" style="border-color:rgba(245,166,35,0.3);">
        <div onclick="toggleAccordion(this)" style="cursor:pointer;display:flex;align-items:center;justify-content:space-between;">
          <div style="display:flex;align-items:center;gap:10px;">
            <span class="badge" style="background:rgba(245,166,35,0.1);color:#f5a623;">í“¨ìƒ·</span>
            <span class="badge" style="background:rgba(0,119,255,0.1);color:#0077ff;">Trade</span>
            <span style="font-size:14px;font-weight:700;">HS Code ë¶„ë¥˜ â€” ìš¸ í˜¼ë°© ì¬í‚·</span>
          </div>
          <i class="fa-solid fa-chevron-down accordion-arrow" style="color:var(--text3);"></i>
        </div>
        <div class="accordion-body">
          <hr class="divider"/>
          <div class="code-box" style="font-size:11.5px;">
** HS Codeë¥¼ ë¶„ë¥˜í•´ì£¼ì„¸ìš”

ì˜ˆì‹œ)
í’ˆëª©: "ë©´ìœ¼ë¡œ ë§Œë“  ë‚¨ì„±ìš© í‹°ì…”ì¸ " -> 6109.10
í’ˆëª©: "í´ë¦¬ì—ìŠ¤í…Œë¥´ ì†Œì¬ ì—¬ì„± ë¸”ë¼ìš°ìŠ¤" -> 6110.10
í’ˆëª©: "ì•„ë™ìš© ë°ë‹˜ ë°”ì§€" -> 6111.10

í’ˆëª©: "ìš¸ í˜¼ë°© ë‚¨ì„± ì¬í‚·" -> HS Code?</div>
          <div class="theory-block" style="margin-top:12px;border-color:#f5a623;">
            <div style="font-size:12px;color:var(--text2);">
              âœ… ì •ë‹µ: <strong style="color:var(--text);">6203.31</strong> â€” ìš¸(í˜¼ë°©) ë‚¨ì„± ì¬í‚·, ì§ë¬¼ ê¸°ì¤€<br>
              â„¹ï¸ í˜¼ë°©ì´ë¼ë„ ì¤‘ëŸ‰ ë¹„ìœ¨ ê°€ì¥ ë†’ì€ ì†Œì¬ ê¸°ì¤€ â†’ ìš¸ì´ ì£¼ì¬ë£Œë©´ 6203.31
            </div>
          </div>
        </div>
      </div>

      <!-- Example 3 -->
      <div class="card" style="border-color:rgba(255,107,107,0.3);">
        <div onclick="toggleAccordion(this)" style="cursor:pointer;display:flex;align-items:center;justify-content:space-between;">
          <div style="display:flex;align-items:center;gap:10px;">
            <span class="badge" style="background:rgba(255,107,107,0.1);color:#ff6b6b;">ì´ìš©ì í˜ë¥´ì†Œë‚˜</span>
            <span class="badge" style="background:rgba(0,119,255,0.1);color:#0077ff;">Writing</span>
            <span style="font-size:14px;font-weight:700;">ì¤‘ì†Œê¸°ì—… ëŒ€í‘œ â€” ì²« ìˆ˜ì¶œ 3ë‹¨ê³„</span>
          </div>
          <i class="fa-solid fa-chevron-down accordion-arrow" style="color:var(--text3);"></i>
        </div>
        <div class="accordion-body">
          <hr class="divider"/>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;" class="grid-2">
            <div>
              <div class="label-sm">ì´ìš©ì ì •ë³´ í”„ë¡¬í”„íŠ¸</div>
              <div class="code-box" style="font-size:11.5px;">
# ì´ìš©ì ì •ë³´
- ì§ì±…: ì¤‘ì†Œê¸°ì—… ëŒ€í‘œ (ì§ì› 30ëª…)
- ìˆ˜ì¶œê²½í—˜: êµ­ë‚´ ì˜ì—…ë§Œ 10ë…„, í•´ì™¸ ìˆ˜ì¶œ ì²˜ìŒ
- ê´€ì‹¬ì‚¬: ë¦¬ìŠ¤í¬ ìµœì†Œí™”, ë¹ ë¥¸ ì‹¤í–‰
- ìš°ë ¤: "ë³µì¡í•˜ê³  ì–´ë ¤ìš¸ ê²ƒ ê°™ë‹¤"
- ì‹œê°„: ë°”ë¹ ì„œ ê¸´ ê¸€ ì½ì§€ ì•ŠìŒ

# ì§€ì‹
ì²« ìˆ˜ì¶œ ì¤€ë¹„ 3ë‹¨ê³„ë¥¼ ì„¤ëª…í•˜ì„¸ìš”
ì „ë¬¸ ìš©ì–´ëŠ” ìµœì†Œí™”í•˜ê³ ,
ê° ë‹¨ê³„ëŠ” 3ì¤„ ì´ë‚´ë¡œ ì‘ì„±í•˜ì„¸ìš”</div>
            </div>
            <div>
              <div class="label-sm">AI ì‘ë‹µ ìš”ì•½</div>
              <div style="display:grid;gap:8px;">
                <div class="theory-block" style="border-color:var(--accent);">
                  <div style="font-size:12px;font-weight:700;color:var(--accent);">1ë‹¨ê³„: ìˆ˜ì¶œì…ë²ˆí˜¸ ë°œê¸‰</div>
                  <div style="font-size:11px;color:var(--text2);">ê´€ì„¸ì²­ í™ˆí˜ì´ì§€ or ê´€ì„¸ì‚¬ ìœ„íƒ â†’ í•˜ë£¨ë©´ ì™„ë£Œ</div>
                </div>
                <div class="theory-block" style="border-color:#0077ff;">
                  <div style="font-size:12px;font-weight:700;color:#0077ff;">2ë‹¨ê³„: ì•ˆì „í•œ ê²°ì œ ë°©ë²•</div>
                  <div style="font-size:11px;color:var(--text2);">T/T(ì „ì‹ í™˜) + ë¬´ì—­ë³´í—˜ìœ¼ë¡œ ë¦¬ìŠ¤í¬ ìµœì†Œí™”</div>
                </div>
                <div class="theory-block" style="border-color:#f5a623;">
                  <div style="font-size:12px;font-weight:700;color:#f5a623;">3ë‹¨ê³„: í¬ì›Œë”© ì—…ì²´ ì„ ì •</div>
                  <div style="font-size:11px;color:var(--text2);">ì¸ë³´ì´ìŠ¤ë§Œ ì¤€ë¹„í•˜ë©´ í†µê´€ê¹Œì§€ ëŒ€ì‹  ì²˜ë¦¬</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Example 4 -->
      <div class="card" style="border-color:rgba(121,192,255,0.3);">
        <div onclick="toggleAccordion(this)" style="cursor:pointer;display:flex;align-items:center;justify-content:space-between;">
          <div style="display:flex;align-items:center;gap:10px;">
            <span class="badge" style="background:rgba(121,192,255,0.1);color:#79c0ff;">ì¶• ê¸°ë°˜ ë¹„êµ</span>
            <span class="badge" style="background:rgba(128,0,255,0.1);color:#a855f7;">Dev</span>
            <span style="font-size:14px;font-weight:700;">FastAPI vs Django vs Flask vs Express â€” REST API ë¹„êµ</span>
          </div>
          <i class="fa-solid fa-chevron-down accordion-arrow" style="color:var(--text3);"></i>
        </div>
        <div class="accordion-body">
          <hr class="divider"/>
          <div style="overflow-x:auto;">
            <table style="width:100%;border-collapse:collapse;font-size:12px;">
              <thead>
                <tr style="background:var(--surface2);">
                  <th style="padding:10px;border:1px solid var(--border);text-align:left;">í‰ê°€ ê¸°ì¤€</th>
                  <th style="padding:10px;border:1px solid var(--border);text-align:center;color:var(--accent);">FastAPI</th>
                  <th style="padding:10px;border:1px solid var(--border);text-align:center;color:#0077ff;">Django</th>
                  <th style="padding:10px;border:1px solid var(--border);text-align:center;color:#f5a623;">Flask</th>
                  <th style="padding:10px;border:1px solid var(--border);text-align:center;color:#ff6b6b;">Express</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding:9px;border:1px solid var(--border);color:var(--text2);">ê°œë°œ ì†ë„</td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">ë¹ ë¦„</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(128,128,128,0.1);color:var(--text3);">ë³´í†µ</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(128,128,128,0.1);color:var(--text3);">ë³´í†µ</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">ë¹ ë¦„</span></td>
                </tr>
                <tr>
                  <td style="padding:9px;border:1px solid var(--border);color:var(--text2);">ìœ ì§€ ë³´ìˆ˜</td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">ì‰¬ì›€</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(128,128,128,0.1);color:var(--text3);">ë³´í†µ</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(128,128,128,0.1);color:var(--text3);">ë³´í†µ</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(128,128,128,0.1);color:var(--text3);">ë³´í†µ</span></td>
                </tr>
                <tr>
                  <td style="padding:9px;border:1px solid var(--border);color:var(--text2);">ë¹„ìš©</td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">ë¬´ë£Œ</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">ë¬´ë£Œ</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">ë¬´ë£Œ</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">ë¬´ë£Œ</span></td>
                </tr>
                <tr>
                  <td style="padding:9px;border:1px solid var(--border);color:var(--text2);">í™•ì¥ì„±</td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">ë†’ìŒ</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(128,128,128,0.1);color:var(--text3);">ë³´í†µ</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(255,107,107,0.1);color:#ff6b6b;">ë‚®ìŒ</span></td>
                  <td style="padding:9px;border:1px solid var(--border);text-align:center;"><span class="badge" style="background:rgba(0,212,170,0.1);color:var(--accent);">ë†’ìŒ</span></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="theory-block" style="margin-top:12px;border-color:var(--accent);">
            <div style="font-size:12px;color:var(--text2);">
              ğŸ† ë¬´ì—­ ë°ì´í„° API ì„œë²„ ì¶”ì²œ: <strong style="color:var(--accent);">FastAPI</strong> â€” Swagger ìë™ ìƒì„±, ë¹„ë™ê¸° ì§€ì›, Pydantic ê²€ì¦ìœ¼ë¡œ ë¬´ì—­ ë°ì´í„° ì²˜ë¦¬ì— ìµœì 
            </div>
          </div>
        </div>
      </div>

      <!-- Example 5: DB ì¶”ì²œ -->
      <div class="card" style="border-color:rgba(195,232,141,0.3);">
        <div onclick="toggleAccordion(this)" style="cursor:pointer;display:flex;align-items:center;justify-content:space-between;">
          <div style="display:flex;align-items:center;gap:10px;">
            <span class="badge" style="background:rgba(195,232,141,0.1);color:#c3e88d;">ìƒí™©ë³„ ë¶„ê¸°</span>
            <span class="badge" style="background:rgba(128,0,255,0.1);color:#a855f7;">Dev</span>
            <span style="font-size:14px;font-weight:700;">ìƒí™©ë³„ ìµœì  ë°ì´í„°ë² ì´ìŠ¤ ì¶”ì²œ</span>
          </div>
          <i class="fa-solid fa-chevron-down accordion-arrow" style="color:var(--text3);"></i>
        </div>
        <div class="accordion-body">
          <hr class="divider"/>
          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;" class="grid-2">
            <div class="theory-block" style="border-color:var(--accent);">
              <div style="font-size:12px;font-weight:700;color:var(--accent);margin-bottom:6px;">ìƒí™© A â€” ìŠ¤íƒ€íŠ¸ì—… MVP</div>
              <div style="font-size:11px;color:var(--text2);">ğŸ¥‡ PostgreSQL(Supabase) â€” ì¸ì¦Â·APIÂ·DB í•œ ë²ˆì—<br>ğŸ¥ˆ MongoDB Atlas â€” ìŠ¤í‚¤ë§ˆ ì—†ì´ ë¹ ë¥´ê²Œ<br>ğŸ¥‰ SQLite â€” ì„œë²„ ì„¤ì • ì—†ì´ ì‹œì‘</div>
            </div>
            <div class="theory-block" style="border-color:#0077ff;">
              <div style="font-size:12px;font-weight:700;color:#0077ff;margin-bottom:6px;">ìƒí™© B â€” 10ë…„ ë¬´ì—­ ë°ì´í„° í†µê³„</div>
              <div style="font-size:11px;color:var(--text2);">ğŸ¥‡ PostgreSQL â€” ë³µì¡í•œ ì¡°ì¸Â·ìœˆë„ìš° í•¨ìˆ˜<br>ğŸ¥ˆ ClickHouse â€” ì»¬ëŸ¼í˜•, ì§‘ê³„ ì¿¼ë¦¬ ì••ë„ì <br>ğŸ¥‰ BigQuery â€” ì„œë²„ ì—†ì´ SQLë¡œ í˜íƒ€ë°”ì´íŠ¸</div>
            </div>
            <div class="theory-block" style="border-color:#f5a623;">
              <div style="font-size:12px;font-weight:700;color:#f5a623;margin-bottom:6px;">ìƒí™© C â€” ì‹¤ì‹œê°„ í™˜ìœ¨ ì´ˆë‹¹ 1,000ê±´</div>
              <div style="font-size:11px;color:var(--text2);">ğŸ¥‡ Redis â€” ì¸ë©”ëª¨ë¦¬, ì´ˆë‹¹ ìˆ˜ë§Œ ê±´ ì²˜ë¦¬<br>ğŸ¥ˆ InfluxDB â€” ì‹œê³„ì—´ íŠ¹í™”, ì••ì¶• ì €ì¥<br>ğŸ¥‰ ScyllaDB â€” ëŒ€ê·œëª¨ ê³ ê°€ìš©ì„±</div>
            </div>
            <div class="theory-block" style="border-color:#ff6b6b;">
              <div style="font-size:12px;font-weight:700;color:#ff6b6b;margin-bottom:6px;">ìƒí™© D â€” ë¹„ì •í˜• í†µê´€ ë¬¸ì„œ</div>
              <div style="font-size:11px;color:var(--text2);">ğŸ¥‡ MongoDB â€” JSON ë¬¸ì„œ ì €ì¥ í‘œì¤€<br>ğŸ¥ˆ Elasticsearch â€” í‚¤ì›Œë“œ ê²€ìƒ‰ ê°•ë ¥<br>ğŸ¥‰ PostgreSQL(JSONB) â€” ì •í˜•+ë¹„ì •í˜• í˜¼í•©</div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ===================== PANEL: ARCHIVE ===================== -->
  <div id="panel-archive" class="panel">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px;">
      <div>
        <h2 class="display" style="font-size:20px;font-weight:700;">My Prompt Archive</h2>
        <p style="color:var(--text2);font-size:13px;margin-top:4px;">ì €ì¥í•œ í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ â€” ê²€ìƒ‰Â·ë¶ˆëŸ¬ì˜¤ê¸°Â·ì‚­ì œÂ·Export</p>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <input id="searchInp" class="inp" style="width:200px;resize:none;" placeholder="ğŸ” ê²€ìƒ‰..." oninput="renderArchive()"/>
        <select id="filterCat" class="inp" style="width:auto;resize:none;" onchange="renderArchive()">
          <option value="ALL">ì „ì²´</option>
          <option value="General">General</option>
          <option value="Trade">Trade</option>
          <option value="Compliance">Compliance</option>
          <option value="Dev">Dev</option>
          <option value="Writing">Writing</option>
          <option value="Research">Research</option>
        </select>
        <select id="sortOrder" class="inp" style="width:auto;resize:none;" onchange="renderArchive()">
          <option value="new">ìµœì‹ ìˆœ</option>
          <option value="old">ì˜¤ë˜ëœìˆœ</option>
          <option value="az">ì´ë¦„ Aâ†’Z</option>
        </select>
      </div>
    </div>

    <div id="archiveList" style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;"></div>
  </div>

</main>

<script>
// ==========================================
// API KEY ê´€ë¦¬ â€” config.js íŒŒì¼ ë°©ì‹
// ==========================================
function getApiKey() {
  if(typeof ANTHROPIC_CONFIG !== "undefined" &&
     ANTHROPIC_CONFIG.apiKey &&
     !ANTHROPIC_CONFIG.apiKey.includes("ì—¬ê¸°ì—_í‚¤_ì…ë ¥") &&
     !ANTHROPIC_CONFIG.apiKey.includes("ì—¬ê¸°ì—_API_í‚¤ë¥¼_ì…ë ¥í•˜ì„¸ìš”")) {
    return ANTHROPIC_CONFIG.apiKey;
  }
  return "";
}

function openApiModal() {
  const key = getApiKey();
  const statusEl = $("apiModalStatus");
  if(key) {
    statusEl.style.background = "rgba(0,212,170,0.08)";
    statusEl.style.border = "1px solid rgba(0,212,170,0.3)";
    statusEl.style.color = "var(--accent)";
    statusEl.innerHTML = `<i class="fa-solid fa-circle-check" style="margin-right:6px;"></i>
      API í‚¤ê°€ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br>
      <span style="font-size:11px;color:var(--text3);">ë³€ê²½í•˜ë ¤ë©´ config.js íŒŒì¼ì„ ì§ì ‘ ìˆ˜ì • í›„ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.</span>`;
  } else {
    statusEl.style.background = "rgba(255,107,107,0.08)";
    statusEl.style.border = "1px solid rgba(255,107,107,0.3)";
    statusEl.style.color = "#ff6b6b";
    statusEl.innerHTML = `<i class="fa-solid fa-triangle-exclamation" style="margin-right:6px;"></i>
      API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>
      <span style="font-size:11px;color:var(--text3);">ì•„ë˜ ì•ˆë‚´ì— ë”°ë¼ config.js íŒŒì¼ì„ ìˆ˜ì •í•´ì£¼ì„¸ìš”.</span>`;
  }
  $("apiModal").classList.remove("hidden");
}

function closeApiModal() { $("apiModal").classList.add("hidden"); }

function updateApiStatus(connected) {
  $("apiBadge").className = "api-badge " + (connected?"connected":"disconnected");
  $("apiDot").className   = "api-dot " + (connected?"on":"off");
  $("apiStatus").textContent = connected ? "API ì—°ê²°ë¨" : "API ë¯¸ì—°ê²°";
}

// ==========================================
// CLAUDE API í˜¸ì¶œ
// ==========================================
async function callClaude(messages, system, maxTokens=1000) {
  // config.jsì—ì„œ ì„¤ì •í•œ í”„ë¡ì‹œ URL
  // (ë„¤ê°€ 3ë‹¨ê³„ì—ì„œ APP_CONFIG.proxyUrl = "/.netlify/functions/claude" í•´ë‘” ìƒíƒœ)
  const url = (typeof APP_CONFIG !== "undefined" && APP_CONFIG.proxyUrl)
    ? APP_CONFIG.proxyUrl
    : "/.netlify/functions/claude";

  const res = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      messages,
      system,
      max_tokens: maxTokens
    })
  });

  const data = await res.json().catch(()=> ({}));

  if (!res.ok) {
    throw new Error(data.error || `HTTP ${res.status}`);
  }

  // netlify í•¨ìˆ˜ê°€ { text: "..." } í˜•íƒœë¡œ ë‚´ë ¤ì£¼ê²Œ í–ˆìœ¼ë‹ˆ
  return data.text || "";
}


// íƒ€ì´í•‘ íš¨ê³¼ ì‹œë®¬ë ˆì´ì…˜ (CORS ì´ìŠˆ ì—†ëŠ” ì¼ë°˜ fetch ì‚¬ìš©)
async function callClaudeStreaming(messages, system, targetEl, onDone) {
  const serverless = (window.APP_CONFIG && APP_CONFIG.USE_SERVERLESS);
  if(!serverless && !getApiKey()) {
    targetEl.innerHTML = `<span style="color:#ff6b6b;">âš ï¸ API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ìš°ì¸¡ ìƒë‹¨ <strong>API ë¯¸ì—°ê²°</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>`;
    return;
  }

  targetEl.innerHTML = '<span class="ai-cursor"></span>';

  try {
    const fullText = await callClaude(messages, system, 1200);
    await typewriterEffect(targetEl, fullText);
    if(onDone) onDone(fullText);
  } catch(e) {
    targetEl.innerHTML = `<span style="color:#ff6b6b;">ì˜¤ë¥˜: ${esc(e.message)}</span>`;
  }
}


// íƒ€ì´í•‘ íš¨ê³¼ (ì²­í¬ ë‹¨ìœ„ë¡œ ë Œë”ë§)
async function typewriterEffect(targetEl, fullText) {
  const chunkSize = 8;
  let current = "";
  for(let i = 0; i < fullText.length; i += chunkSize) {
    current += fullText.slice(i, i + chunkSize);
    targetEl.innerHTML = `<div class="md-render">${mdRender(current)}</div><span class="ai-cursor"></span>`;
    await new Promise(r => setTimeout(r, 16));
  }
  targetEl.innerHTML = `<div class="md-render">${mdRender(fullText)}</div>`;
}

// ==========================================
// AI ê¸°ëŠ¥ 1: ì´ë¡  ì‹¬í™” ì„¤ëª…
// ==========================================
const theoryMeta = {
  t1:{ title:"í”„ë¡¬í”„íŠ¸ 3ê°€ì§€ ìœ í˜•", topic:"ì„œìˆ í˜•Â·ì§€ì¹¨í˜•Â·í•¨ìˆ˜í˜• í”„ë¡¬í”„íŠ¸ì˜ ê°œë…ê³¼ ì°¨ì´" },
  t2:{ title:"ì œë¡œìƒ·Â·ì›ìƒ·Â·í“¨ìƒ· ê¸°ë²•", topic:"Zero-Shot/One-Shot/Few-Shot í”„ë¡¬í”„íŒ… ê¸°ë²•" },
  t3:{ title:"í˜ë¥´ì†Œë‚˜ íŒ¨í„´", topic:"AI í˜ë¥´ì†Œë‚˜ ì„¤ê³„ 4ìš”ì†Œ ë° ë©€í‹° í˜ë¥´ì†Œë‚˜ íŒ¨í„´" },
  t4:{ title:"ë§ˆí¬ë‹¤ìš´ êµ¬ì¡°í™”", topic:"ë§ˆí¬ë‹¤ìš´(#í—¤ë”/ì½”ë“œë¸”ë¡/ì¸ìš©ë¬¸/í‘œ)ì„ í™œìš©í•œ í”„ë¡¬í”„íŠ¸ êµ¬ì¡°í™”" },
  t5:{ title:"í‘œí˜„ ê°•ë„Â·ìš°ì„ ìˆœìœ„ ì¡°ì ˆ", topic:"í”„ë¡¬í”„íŠ¸ ì§€ì‹œ ê°•ë„ 4ë‹¨ê³„ì™€ ìš°ì„ ìˆœìœ„ ê³„ì¸µ ì„¤ê³„" },
  t6:{ title:"ëŒ€ì•ˆ ì ‘ê·¼ë²• íŒ¨í„´", topic:"ë‹¨ìˆœë‚˜ì—´Â·ì¶•ë¹„êµÂ·ìƒí™©ë¶„ê¸°Â·ì—­ë°œìƒ 4ê°€ì§€ ëŒ€ì•ˆ íŒ¨í„´" },
  t7:{ title:"ë ˆì‹œí”¼ íŒ¨í„´", topic:"ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ë‹¨ê³„ë³„ ë ˆì‹œí”¼ í”„ë¡¬í”„íŠ¸ íŒ¨í„´ (ë¶„ê¸°Â·ì²´í¬ë¦¬ìŠ¤íŠ¸ í¬í•¨)" },
  t8:{ title:"ë’¤ì§‘íŒ ìƒí˜¸ì‘ìš© íŒ¨í„´", topic:"AIê°€ ë¨¼ì € ì§ˆë¬¸í•˜ê³  ì‚¬ìš©ìê°€ ë‹µí•˜ëŠ” ì—­ë°©í–¥ ìƒí˜¸ì‘ìš© íŒ¨í„´" },
  t9:{ title:"ì¸ì§€ ê²€ì¦ì íŒ¨í„´", topic:"ë³µì¡í•œ ì§ˆë¬¸ì„ í•˜ìœ„ ì§ˆë¬¸ìœ¼ë¡œ ë¶„í•´Â·ê²€ì¦Â·í†µí•©í•˜ëŠ” íŒ¨í„´ê³¼ ì´ìš©ì í˜ë¥´ì†Œë‚˜ ì²´í¬ë¦¬ìŠ¤íŠ¸" },
};
let currentTheoryId = "t1";

async function aiExplainCurrentTheory() {
  const serverless = (window.APP_CONFIG && APP_CONFIG.USE_SERVERLESS);
  if(!serverless && !getApiKey()) { openApiModal(); return; }

  const meta = theoryMeta[currentTheoryId];
  $("explainTitle").textContent = meta.title + " â€” AI ì‹¬í™” ì„¤ëª…";
  $("explainContent").innerHTML = '<div style="display:flex;align-items:center;gap:8px;color:var(--text3);"><div class="spinner"></div> ì„¤ëª…ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</div>';
  $("aiExplainModal").classList.remove("hidden");

  const system = `ë‹¹ì‹ ì€ ë¬´ì—­ ì‹¤ë¬´ì™€ AI í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ì·¨ì—… ì¤€ë¹„ ì¤‘ì¸ ë¬´ì—­Â·IT ê´€ì‹¬ ëŒ€í•™ìƒì—ê²Œ ê°œë…ì„ ì„¤ëª…í•©ë‹ˆë‹¤.
ë§ˆí¬ë‹¤ìš´ì„ í™œìš©í•´ êµ¬ì¡°ì ìœ¼ë¡œ ì‘ì„±í•˜ê³ , ë°˜ë“œì‹œ ë¬´ì—­ ì‹¤ë¬´ ì˜ˆì‹œë¥¼ í¬í•¨í•˜ì„¸ìš”.`;

  await callClaudeStreaming(
    [{role:"user", content:`"${meta.topic}"ì— ëŒ€í•´ ë‹¤ìŒ êµ¬ì¡°ë¡œ ì‹¬í™” ì„¤ëª…í•´ì£¼ì„¸ìš”:

## í•µì‹¬ ì›ë¦¬
(í•œ ë‹¨ë½ìœ¼ë¡œ ì‰½ê²Œ ì„¤ëª…)

## ì™œ ì¤‘ìš”í•œê°€?
(ë¬´ì—­ ì‹¤ë¬´ì—ì„œì˜ ì‹¤ì§ˆì  íš¨ê³¼)

## ì‹¤ì „ ì˜ˆì‹œ
(ì‹¤ì œë¡œ ì“¸ ìˆ˜ ìˆëŠ” ë¬´ì—­ ê´€ë ¨ í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œ ì½”ë“œ 2ê°œ í¬í•¨)

## ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜
(ì´ˆë³´ìê°€ ë†“ì¹˜ëŠ” í¬ì¸íŠ¸ 2~3ê°€ì§€)

## í•µì‹¬ ìš”ì•½
(3ì¤„ ì´ë‚´ bullet í¬ì¸íŠ¸)`}],
    system,
    $("explainContent")
  );
}


function closeExplainModal() { $("aiExplainModal").classList.add("hidden"); }

// ==========================================
// AI ê¸°ëŠ¥ 2: í”„ë¡¬í”„íŠ¸ í’ˆì§ˆ ë¶„ì„
// ==========================================
async function aiAnalyzePrompt() {
  const serverless = (window.APP_CONFIG && APP_CONFIG.USE_SERVERLESS);
  if(!serverless && !getApiKey()) { openApiModal(); return; }

  const prompt = $("outputRaw").textContent;
  if(!prompt || prompt.includes("í”„ë¡¬í”„íŠ¸ ì¡°í•© ë²„íŠ¼")) {
    toast("ë¨¼ì € í”„ë¡¬í”„íŠ¸ë¥¼ ì¡°í•©í•´ì£¼ì„¸ìš”", "#f5a623"); return;
  }

  const panel = $("aiFeedbackPanel");
  const content = $("aiFeedbackContent");
  const spinner = $("feedbackSpinner");
  const icon = $("feedbackIcon");

  panel.classList.add("visible");
  spinner.style.display = "inline-block";
  icon.style.display = "none";
  content.innerHTML = '<span style="color:var(--text3);">ë¶„ì„ ì¤‘...</span>';

  const system = `ë‹¹ì‹ ì€ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ì œê³µëœ í”„ë¡¬í”„íŠ¸ë¥¼ ë¶„ì„í•˜ê³  ì‹¤ì§ˆì ì¸ ê°œì„  ë°©í–¥ì„ ì œì‹œí•˜ì„¸ìš”.
í•œêµ­ì–´ë¡œ ì‘ë‹µí•˜ê³ , ë§ˆí¬ë‹¤ìš´ì„ í™œìš©í•´ ëª…í™•í•˜ê²Œ êµ¬ì¡°í™”í•˜ì„¸ìš”.`;

  await callClaudeStreaming(
    [{role:"user", content:`ì•„ë˜ í”„ë¡¬í”„íŠ¸ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”:\n\n\`\`\`\n${prompt}\n\`\`\`\n\në‹¤ìŒ í•­ëª©ìœ¼ë¡œ í‰ê°€í•´ì£¼ì„¸ìš”:\n\n## ğŸ“Š í’ˆì§ˆ í‰ê°€ (â˜… 1~5)\n- êµ¬ì¡° ëª…í™•ì„± (#í—¤ë” í™œìš© ì—¬ë¶€):\n- ì—­í•  ì •ì˜ (í˜ë¥´ì†Œë‚˜ ì„¤ì •):\n- ì§€ì‹œ êµ¬ì²´ì„±:\n- ì¶œë ¥ í˜•ì‹ ëª…ì‹œ:\n- ë³€ìˆ˜/ë°ì´í„° ê²©ë¦¬:\n\n## âœ… ì˜ëœ ì \n(2~3ê°€ì§€)\n\n## âš ï¸ ê°œì„ ì´ í•„ìš”í•œ ì \n(ê°€ì¥ ì¤‘ìš”í•œ 2ê°€ì§€)\n\n## ğŸ’¡ ê°œì„  ì œì•ˆ (ì½”ë“œ í¬í•¨)\n(ìˆ˜ì • ì „ â†’ ìˆ˜ì • í›„ í˜•íƒœë¡œ 1~2ê°œ)`}],
    system,
    content,
    () => { spinner.style.display="none"; icon.style.display="inline"; }
  );
}


  const panel = $("aiFeedbackPanel");
  const content = $("aiFeedbackContent");
  const spinner = $("feedbackSpinner");
  const icon = $("feedbackIcon");

  panel.classList.add("visible");
  spinner.style.display = "inline-block";
  icon.style.display = "none";
  content.innerHTML = '<span style="color:var(--text3);">ë¶„ì„ ì¤‘...</span>';

  const system = `ë‹¹ì‹ ì€ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ì œê³µëœ í”„ë¡¬í”„íŠ¸ë¥¼ ë¶„ì„í•˜ê³  ì‹¤ì§ˆì ì¸ ê°œì„  ë°©í–¥ì„ ì œì‹œí•˜ì„¸ìš”.
í•œêµ­ì–´ë¡œ ì‘ë‹µí•˜ê³ , ë§ˆí¬ë‹¤ìš´ì„ í™œìš©í•´ ëª…í™•í•˜ê²Œ êµ¬ì¡°í™”í•˜ì„¸ìš”.`;

  await callClaudeStreaming(
    [{role:"user", content:`ì•„ë˜ í”„ë¡¬í”„íŠ¸ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”:\n\n\`\`\`\n${prompt}\n\`\`\`\n\në‹¤ìŒ í•­ëª©ìœ¼ë¡œ í‰ê°€í•´ì£¼ì„¸ìš”:\n\n## ğŸ“Š í’ˆì§ˆ í‰ê°€ (â˜… 1~5)\n- êµ¬ì¡° ëª…í™•ì„± (#í—¤ë” í™œìš© ì—¬ë¶€):\n- ì—­í•  ì •ì˜ (í˜ë¥´ì†Œë‚˜ ì„¤ì •):\n- ì§€ì‹œ êµ¬ì²´ì„±:\n- ì¶œë ¥ í˜•ì‹ ëª…ì‹œ:\n- ë³€ìˆ˜/ë°ì´í„° ê²©ë¦¬:\n\n## âœ… ì˜ëœ ì \n(2~3ê°€ì§€)\n\n## âš ï¸ ê°œì„ ì´ í•„ìš”í•œ ì \n(ê°€ì¥ ì¤‘ìš”í•œ 2ê°€ì§€)\n\n## ğŸ’¡ ê°œì„  ì œì•ˆ (ì½”ë“œ í¬í•¨)\n(ìˆ˜ì • ì „ â†’ ìˆ˜ì • í›„ í˜•íƒœë¡œ 1~2ê°œ)`}],
    system,
    content,
    () => { spinner.style.display="none"; icon.style.display="inline"; }
  );

// ==========================================
// DATA & STATE
// ==========================================
const KEY_ARCHIVE = "tplab_v3_prompts";
const KEY_DRAFT   = "tplab_v3_draft";

const toneMap = {
  1: { label:"ë¶€ë“œëŸ½ê²Œ (Lv.1)", prefix:"ê°€ëŠ¥í•˜ë©´", suffix:"í•˜ëŠ” í¸ì´ ì¢‹ìŠµë‹ˆë‹¤", color:"#7ee787", pct:"0%" },
  2: { label:"ê¶Œì¥ (Lv.2)", prefix:"ë˜ë„ë¡", suffix:"í•´ì£¼ì„¸ìš”", color:"#f5a623", pct:"33%" },
  3: { label:"ê°•í•˜ê²Œ (Lv.3)", prefix:"ë°˜ë“œì‹œ", suffix:"í•˜ì„¸ìš”", color:"#ff6b6b", pct:"67%" },
  4: { label:"ì ˆëŒ€ (Lv.4)", prefix:"ì–´ë– í•œ ê²½ìš°ì—ë„", suffix:"ì˜ˆì™¸ ì—†ì´ ì¤€ìˆ˜í•˜ì„¸ìš”", color:"#da1c5c", pct:"100%" },
};

const templates = {
  tariff: {
    category:"Trade",
    ctx:"# ì—­í• \në‹¹ì‹ ì€ ë¬´ì—­ ê·œì œÂ·ê´€ì„¸ ë¦¬ì„œì¹˜ ë‹´ë‹¹ìì…ë‹ˆë‹¤.\n\n# ì›ì¹™\nì¶”ì •í•˜ì§€ ë§ê³ , ë¶ˆí™•ì‹¤í•˜ë©´ ì¶”ê°€ í™•ì¸ í•­ëª©ì„ í•¨ê»˜ ì œì‹œí•©ë‹ˆë‹¤.",
    vars:"{product_name}, {hs_code}, {export_country}, {import_country}",
    inst:"ì…ë ¥ê°’ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì…êµ­ì˜ ê´€ì„¸(MFN/FTA êµ¬ë¶„)ì™€ ë¹„ê´€ì„¸ ê·œì œ(ì¸ì¦/ê²€ì—­/ë¼ë²¨), í•„ìš” ì„œë¥˜ë¥¼ í‘œì¤€ í¬ë§·ìœ¼ë¡œ ì •ë¦¬í•´ì£¼ì„¸ìš”.",
    format:'```json\n{\n  "ê´€ì„¸ìœ¨": "",\n  "ê·œì œì‚¬í•­": [],\n  "í•„ìš”ì„œë¥˜": [],\n  "ì¶”ê°€í™•ì¸": []\n}\n```'
  },
  hs: {
    category:"Trade",
    ctx:"# ì—­í• \në‹¹ì‹ ì€ 20ë…„ ê²½ë ¥ì˜ ê´€ì„¸ì‚¬ì…ë‹ˆë‹¤.\n\n# ëª©í‘œ\ní’ˆëª© ì„¤ëª…ì„ ê·¼ê±°ë¡œ HS Code 6ìë¦¬ë¥¼ ë¶„ë¥˜í•©ë‹ˆë‹¤.",
    vars:"{item_desc}, {material}, {knit_or_woven}",
    inst:"ì•„ë˜ í’ˆëª©ì„ HS í•´ì„¤ì„œ ì›ì¹™(ì£¼ëœ ì¬ì§ˆ/ë³¸ì§ˆì  íŠ¹ì„±)ì„ ì ìš©í•´ 6ìë¦¬ HS Codeë¡œ ë¶„ë¥˜í•´ ì£¼ì„¸ìš”. ê·¼ê±°(í•œ ì¤„)ì™€ í•¨ê»˜ ì œì‹œí•˜ì„¸ìš”.",
    format:'```json\n{\n  "ì¶”ì²œ_HS6": "",\n  "ê·¼ê±°": "",\n  "ì£¼ì˜ì‚¬í•­": []\n}\n```'
  },
  invoice: {
    category:"Trade",
    ctx:"# ì—­í• \në‹¹ì‹ ì€ ë¬´ì—­ ì„œë¥˜ ìë™í™” ë‹´ë‹¹ìì…ë‹ˆë‹¤.\n\n# ëª©í‘œ\nìƒì—…ì†¡ì¥ í•„ìˆ˜ í•­ëª©ì„ ëˆ„ë½ ì—†ì´ êµ¬ì¡°í™”í•©ë‹ˆë‹¤.",
    vars:"{seller}, {buyer}, {incoterms}, {currency}, {items}, {ship_from}, {ship_to}",
    inst:"ìƒì—…ì†¡ì¥(Commercial Invoice) ì´ˆì•ˆì„ JSONìœ¼ë¡œ ìƒì„±í•˜ì„¸ìš”. í•„ìˆ˜ í•„ë“œ ëˆ„ë½ì´ ìˆìœ¼ë©´ 'ì¶”ê°€í™•ì¸'ì— ë„£ì–´ ì£¼ì„¸ìš”.",
    format:'```json\n{\n  "invoice_no": "",\n  "seller": {},\n  "buyer": {},\n  "incoterms": "",\n  "items": [],\n  "total": 0,\n  "additional_checks": []\n}\n```'
  },
  risk: {
    category:"Compliance",
    ctx:"# ì—­í• \në‹¹ì‹ ì€ ìˆ˜ì¶œ ë¦¬ìŠ¤í¬ ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.\n\n# ëª©í‘œ\nì²« ìˆ˜ì¶œ ê¸°ì—…ì´ ë°”ë¡œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ë°›ë„ë¡ í•©ë‹ˆë‹¤.",
    vars:"{product}, {destination_country}, {payment_term}, {buyer_profile}",
    inst:"ë¦¬ìŠ¤í¬ë¥¼ 'ëŒ€ê¸ˆíšŒìˆ˜/í†µê´€ê·œì œ/ë¬¼ë¥˜/ê³„ì•½' 4ì¶•ìœ¼ë¡œ ë‚˜ëˆ„ê³ , ê° ì¶•ë§ˆë‹¤ 1)í•µì‹¬ë¦¬ìŠ¤í¬ 2)ì¦‰ì‹œì¡°ì¹˜ 3)ëŒ€ì•ˆ 1ê°œë¥¼ ì œì‹œí•˜ì„¸ìš”.",
    format:"ë§ˆí¬ë‹¤ìš´ í‘œë¡œ ìš”ì•½í•œ ë’¤, ë§ˆì§€ë§‰ì— 5ì¤„ ì´ë‚´ ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ì£¼ì„¸ìš”."
  },
  email: {
    category:"Writing",
    ctx:"# ì—­í• \në‹¹ì‹ ì€ í•´ì™¸ì˜ì—… ì´ë©”ì¼ ì½”ì¹˜ì…ë‹ˆë‹¤.\n\n# ëª©í‘œ\nì§§ê³  ëª…í™•í•œ ì²« ì œì•ˆ ë©”ì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤.",
    vars:"{company}, {product}, {usp}, {price}, {moq}, {certs}",
    inst:"ë°”ì´ì–´ì—ê²Œ ë³´ë‚´ëŠ” ì²« ì œì•ˆ ë©”ì¼ì„ í•œêµ­ì–´/ì˜ì–´ 2ë²„ì „ìœ¼ë¡œ ì¨ ì£¼ì„¸ìš”. ê³¼ì¥ ì—†ì´, ë‹¤ìŒ í–‰ë™(ìƒ˜í”Œ/ë¯¸íŒ…) ìš”ì²­ì„ í¬í•¨í•˜ì„¸ìš”.",
    format:"ì œëª©/ë³¸ë¬¸ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥."
  },
  compare: {
    category:"Research",
    ctx:"# ì—­í• \në‹¹ì‹ ì€ ê¸°ìˆ  ì˜ì‚¬ê²°ì •ìì…ë‹ˆë‹¤.\n\n# ëª©í‘œ\nëŒ€ì•ˆë“¤ì„ ê°™ì€ ê¸°ì¤€ìœ¼ë¡œ ë¹„êµí•´ ê²°ì •ì„ ë•ìŠµë‹ˆë‹¤.",
    vars:"{options[]}, {criteria[]}",
    inst:"ê° ëŒ€ì•ˆì„ í‰ê°€ ê¸°ì¤€ë³„ë¡œ ë¹„êµí‘œë¥¼ ë§Œë“¤ê³ , ìµœì¢… ì¶”ì²œ 1ê°œì™€ ì´ìœ  3ì¤„ì„ ì œì‹œí•˜ì„¸ìš”.",
    format:"ë§ˆí¬ë‹¤ìš´ í‘œ + ê²°ë¡ "
  },
  persona: {
    category:"General",
    ctx:"# í˜ë¥´ì†Œë‚˜ ìƒì„±\nì—­í• /ê²½ë ¥/ì „ë¬¸ë¶„ì•¼/ë§íˆ¬ë¥¼ ëª…í™•íˆ ì •ì˜í•©ë‹ˆë‹¤.",
    vars:"{role}, {experience}, {expertise}, {tone}",
    inst:"ìœ„ 4ìš”ì†Œë¥¼ í•œ ë¬¸ë‹¨ í˜ë¥´ì†Œë‚˜ ì§€ì‹œë¬¸ìœ¼ë¡œ ì¡°í•©í•˜ê³ , ì´í›„ ë‹µë³€ì€ ê·¸ í†¤ì„ ìœ ì§€í•˜ì„¸ìš”.",
    format:"```text\n[í˜ë¥´ì†Œë‚˜]\n...\n```"
  },
  summary: {
    category:"General",
    ctx:"# ì—­í• \në‹¹ì‹ ì€ í•™ìŠµ ì½”ì¹˜ì…ë‹ˆë‹¤.\n\n# ëª©í‘œ\nê¸´ ë‚´ìš©ì„ ì¬í•™ìŠµí•˜ê¸° ì‰½ê²Œ ë°”ê¿‰ë‹ˆë‹¤.",
    vars:"{text}, {audience}",
    inst:"í•µì‹¬ë§Œ ë‚¨ê¸°ë˜ 1)ìš”ì•½ 2)ì˜¤í•´í•˜ê¸° ì‰¬ìš´ í¬ì¸íŠ¸ 3)ì²´í¬ë¦¬ìŠ¤íŠ¸ 5ê°œ 4)ë³µìŠµ í€´ì¦ˆ 3ë¬¸í•­ì„ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.",
    format:"ë§ˆí¬ë‹¤ìš´"
  }
};

let currentId = null;
let debounceTimer = null;

// ==========================================
// UTILS
// ==========================================
const $ = id => document.getElementById(id);
const nowISO = () => new Date().toISOString();
const uid = () => Math.random().toString(16).slice(2) + "_" + Date.now().toString(16).slice(-4);
const esc = s => (s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");

function getArchive() {
  try { return JSON.parse(localStorage.getItem(KEY_ARCHIVE) || "[]"); } catch { return []; }
}
function setArchive(arr) { localStorage.setItem(KEY_ARCHIVE, JSON.stringify(arr)); }
function updateArchCount() {
  $("archCount").textContent = getArchive().length;
}

function toast(msg, clr="#00d4aa") {
  const t = $("toast");
  t.textContent = msg;
  t.style.borderColor = clr;
  t.style.color = clr;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"), 2200);
}

// ==========================================
// PANEL & THEORY SWITCHING
// ==========================================
function switchPanel(name) {
  document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
  $("panel-"+name).classList.add("active");
  document.querySelectorAll(".nav-tab").forEach(t=>t.classList.remove("active"));
  event.currentTarget.classList.add("active");
  if(name === "archive") renderArchive();
}

// switchTheoryëŠ” API ì„¹ì…˜ì—ì„œ ì´ë¯¸ ì •ì˜ë¨

// ==========================================
// ACCORDION
// ==========================================
function toggleAccordion(header) {
  const body = header.nextElementSibling;
  const arrow = header.querySelector(".accordion-arrow");
  const isOpen = body.classList.contains("open");
  body.classList.toggle("open", !isOpen);
  arrow.classList.toggle("open", !isOpen);
}

// ==========================================
// TONE
// ==========================================
function syncTone() {
  const v = Number($("toneSlider").value);
  const t = toneMap[v];
  $("toneLabel").textContent = t.label;
  $("toneLabel").style.background = t.color + "22";
  $("toneLabel").style.color = t.color;
  $("toneSlider").style.setProperty("--val", t.pct);
}

// ==========================================
// ASSEMBLE PROMPT
// ==========================================
function assemblePrompt() {
  const ctx = ($("p_context").value || "").trim();
  const vars = ($("p_vars").value || "").trim();
  const inst = ($("p_inst").value || "").trim();
  const fmt = ($("p_format").value || "").trim();
  const v = Number($("toneSlider").value);
  const t = toneMap[v];

  const toneGuide = v > 1
    ? `# ì§€ì‹œ ê°•ë„\n> ${t.prefix} ì•„ë˜ ì§€ì‹œë¥¼ ë”°ë¥´ë©°, ì´ëŠ” ${t.suffix}.\n\n`
    : "";

  const output = [
    ctx,
    vars ? `\n# ì…ë ¥ ë°ì´í„°\n${vars}` : "",
    `\n# ì§€ì‹œ ì‚¬í•­\n${toneGuide}${inst}`,
    fmt ? `\n# ì¶œë ¥ í˜•ì‹\n${fmt}` : "",
    "\n# ì¶”ê°€ ê·œì¹™\n> ë¶ˆí™•ì‹¤í•˜ë©´ 'ì¶”ê°€í™•ì¸' í•­ëª©ì— ì§ˆë¬¸ì„ ë„£ê³ , ì¶”ì •í•˜ì§€ ë§ˆì„¸ìš”.\n> ë‹µë³€ì€ êµ°ë”ë”ê¸° ì—†ì´ í•µì‹¬ë§Œ."
  ].filter(Boolean).join("\n");

  $("outputRaw").textContent = output;
  $("outputMd").innerHTML = `<div class="md-render">${mdRender(output)}</div>`;

  // stats
  $("charCount").textContent = output.length.toLocaleString();
  $("lineCount").textContent = output.split("\n").length;
  const score = calcStructureScore(output);
  $("structureScore").textContent = score + "/5";
  $("structureScore").style.color = score >= 4 ? "#00d4aa" : score >= 2 ? "#f5a623" : "#ff6b6b";

  saveDraft();
}

function debouncedAssemble() {
  clearTimeout(debounceTimer);
  $("draftState").textContent = "ë³€ê²½ ê°ì§€ë¨...";
  debounceTimer = setTimeout(assemblePrompt, 300);
}

function calcStructureScore(txt) {
  let s = 0;
  if (/^#\s/m.test(txt)) s++;
  if (/```/.test(txt)) s++;
  if (/^>/m.test(txt)) s++;
  if (/^-\s/m.test(txt)) s++;
  if (/\{[^}]+\}/.test(txt)) s++;
  return s;
}

// ==========================================
// MARKDOWN RENDERER
// ==========================================
function mdRender(text) {
  const src = (text||"").replace(/\r\n/g,"\n");
  const parts = src.split("```");
  let out = "";
  for (let i=0;i<parts.length;i++) {
    if(i%2===1){
      const lines = parts[i].split("\n");
      const lang = lines[0].trim();
      const code = lines.slice(1).join("\n");
      out += `<pre><code class="lang-${esc(lang)}">${esc(code)}</code></pre>`;
    } else {
      let chunk = esc(parts[i]);
      chunk = chunk.replace(/^# (.+)$/gm,"<h1>$1</h1>");
      chunk = chunk.replace(/^## (.+)$/gm,"<h2>$1</h2>");
      chunk = chunk.replace(/^&gt; (.+)$/gm,"<blockquote>$1</blockquote>");
      chunk = chunk.replace(/^- (.+)$/gm,"<ul><li>$1</li></ul>");
      chunk = chunk.replace(/<\/ul>\n<ul>/g,"");
      chunk = chunk.replace(/`([^`]+)`/g,"<code>$1</code>");
      chunk = chunk.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>");
      chunk = chunk.replace(/\*([^*]+)\*/g,"<em>$1</em>");
      chunk = chunk.split("\n\n").map(p=>{
        if(/<(h1|h2|blockquote|ul|pre)/.test(p)) return p;
        return `<p>${p.replace(/\n/g,"<br/>")}</p>`;
      }).join("");
      out += chunk;
    }
  }
  return out;
}

// ==========================================
// COPY / VIEW
// ==========================================
async function copyOutput() {
  const txt = $("outputRaw").textContent;
  try {
    await navigator.clipboard.writeText(txt);
    toast("âœ“ í´ë¦½ë³´ë“œì— ë³µì‚¬ë¨");
  } catch {
    const ta = document.createElement("textarea");
    ta.value = txt; document.body.appendChild(ta);
    ta.select(); document.execCommand("copy"); ta.remove();
    toast("âœ“ ë³µì‚¬ë¨ (fallback)");
  }
}

function syncView() {
  const m = $("viewMode").value;
  $("outputRaw").style.display = m==="raw"?"block":"none";
  $("outputMd").style.display  = m==="md"?"block":"none";
}

// ==========================================
// TEMPLATE LOADER
// ==========================================
function loadTemplate(key) {
  const t = templates[key];
  if(!t) return;
  currentId = null;
  $("editingLabel").textContent = "ìƒˆ í”„ë¡¬í”„íŠ¸";
  $("category").value = t.category || "General";
  $("p_context").value = t.ctx || "";
  $("p_vars").value    = t.vars || "";
  $("p_inst").value    = t.inst || "";
  $("p_format").value  = t.format || "";
  assemblePrompt();
}

function loadToBuilder(key) {
  loadTemplate(key);
  // switch to builder panel
  document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
  $("panel-builder").classList.add("active");
  document.querySelectorAll(".nav-tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll(".nav-tab")[1].classList.add("active");
  toast("ë¹Œë”ë¡œ ë¡œë“œ ì™„ë£Œ");
}

// ==========================================
// CLEAR
// ==========================================
function clearBuilder() {
  if(!confirm("í˜„ì¬ ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì„ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
  currentId = null;
  $("editingLabel").textContent = "ìƒˆ í”„ë¡¬í”„íŠ¸";
  $("p_context").value = "";
  $("p_vars").value = "";
  $("p_inst").value = "";
  $("p_format").value = "";
  $("outputRaw").textContent = "í”„ë¡¬í”„íŠ¸ ì¡°í•© ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.";
  $("outputMd").innerHTML = "";
  $("charCount").textContent = "0";
  $("lineCount").textContent = "0";
  $("structureScore").textContent = "â€”";
}

// ==========================================
// DRAFT
// ==========================================
function saveDraft() {
  const d = {
    currentId, category:$("category").value, tone:Number($("toneSlider").value),
    ctx:$("p_context").value, vars:$("p_vars").value,
    inst:$("p_inst").value, format:$("p_format").value
  };
  localStorage.setItem(KEY_DRAFT, JSON.stringify(d));
  $("draftState").textContent = "ìë™ì €ì¥ ì™„ë£Œ " + new Date().toLocaleTimeString();
}

function loadDraft() {
  try {
    const d = JSON.parse(localStorage.getItem(KEY_DRAFT) || "null");
    if(!d) return false;
    currentId = d.currentId||null;
    $("category").value = d.category||"General";
    $("toneSlider").value = d.tone||2;
    syncTone();
    $("p_context").value = d.ctx||"";
    $("p_vars").value    = d.vars||"";
    $("p_inst").value    = d.inst||"";
    $("p_format").value  = d.format||"";
    assemblePrompt();
    return true;
  } catch { return false; }
}

// ==========================================
// SAVE / LOAD / DELETE ARCHIVE
// ==========================================
function savePrompt() {
  assemblePrompt();
  const content = $("outputRaw").textContent;
  const title = prompt("ì €ì¥í•  ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.\níŒ: í…œí”Œë¦¿ëª… + í•µì‹¬ í¬ì¸íŠ¸ + í†¤ì„ ê°™ì´ ì“°ë©´ ì¬í•™ìŠµì— ë„ì›€ì´ ë©ë‹ˆë‹¤.");
  if(!title) return;

  const archive = getArchive();
  const existing = archive.find(x=>x.id===currentId);
  const item = {
    id: currentId || uid(),
    title, category:$("category").value, tone:Number($("toneSlider").value),
    ctx:$("p_context").value, vars:$("p_vars").value,
    inst:$("p_inst").value, format:$("p_format").value,
    content,
    created_at: existing?.created_at || nowISO(),
    updated_at: nowISO()
  };

  const idx = archive.findIndex(x=>x.id===item.id);
  if(idx>=0) archive[idx]=item; else archive.unshift(item);
  currentId = item.id;
  $("editingLabel").textContent = `í¸ì§‘ ì¤‘: ${item.title}`;

  setArchive(archive);
  updateArchCount();
  toast("âœ“ ì €ì¥ ì™„ë£Œ!");
}

function loadFromArchive(id) {
  const item = getArchive().find(x=>x.id===id);
  if(!item) return;
  currentId = item.id;
  $("category").value = item.category||"General";
  $("toneSlider").value = item.tone||2;
  syncTone();
  $("p_context").value = item.ctx||"";
  $("p_vars").value    = item.vars||"";
  $("p_inst").value    = item.inst||"";
  $("p_format").value  = item.format||"";
  $("editingLabel").textContent = `í¸ì§‘ ì¤‘: ${item.title}`;
  assemblePrompt();

  // go to builder
  document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
  $("panel-builder").classList.add("active");
  document.querySelectorAll(".nav-tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll(".nav-tab")[1].classList.add("active");
  toast("âœ“ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ: " + item.title);
}

function duplicateFromArchive(id) {
  const archive = getArchive();
  const item = archive.find(x=>x.id===id);
  if(!item) return;
  const copy = {...item, id:uid(), title:item.title+" (ë³µì œ)", created_at:nowISO(), updated_at:nowISO()};
  archive.unshift(copy);
  setArchive(archive);
  renderArchive();
  updateArchCount();
  toast("âœ“ ë³µì œ ì™„ë£Œ");
}

function deleteFromArchive(id) {
  const item = getArchive().find(x=>x.id===id);
  if(!item) return;
  if(!confirm(`ì‚­ì œí• ê¹Œìš”?\n"${item.title}"`)) return;
  setArchive(getArchive().filter(x=>x.id!==id));
  if(currentId===id) { currentId=null; $("editingLabel").textContent="ìƒˆ í”„ë¡¬í”„íŠ¸"; }
  renderArchive();
  updateArchCount();
  toast("ì‚­ì œ ì™„ë£Œ", "#ff6b6b");
}

// ==========================================
// RENDER ARCHIVE
// ==========================================
function renderArchive() {
  const q = ($("searchInp")?.value||"").toLowerCase();
  const cat = $("filterCat")?.value||"ALL";
  const sort = $("sortOrder")?.value||"new";

  let list = getArchive();
  if(cat!=="ALL") list = list.filter(x=>(x.category||"General")===cat);
  if(q) list = list.filter(x=>(x.title||"").toLowerCase().includes(q)||(x.content||"").toLowerCase().includes(q));
  list.sort((a,b) => {
    if(sort==="new") return b.updated_at.localeCompare(a.updated_at);
    if(sort==="old") return a.updated_at.localeCompare(b.updated_at);
    return (a.title||"").localeCompare(b.title||"");
  });

  const el = $("archiveList");
  if(list.length===0) {
    el.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:48px;color:var(--text3);">
      <i class="fa-solid fa-box-open" style="font-size:32px;margin-bottom:12px;display:block;"></i>
      <div style="font-size:14px;">ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ê°€ ì—†ì–´ìš”.</div>
      <div style="font-size:12px;margin-top:4px;">ë¹Œë”ì—ì„œ í”„ë¡¬í”„íŠ¸ë¥¼ ë§Œë“¤ê³  ì €ì¥í•´ ë³´ì„¸ìš”.</div>
    </div>`;
    return;
  }

  const catColor = {
    Trade:"rgba(0,212,170,0.1);color:#00d4aa",
    Compliance:"rgba(255,107,107,0.1);color:#ff6b6b",
    Dev:"rgba(0,119,255,0.1);color:#0077ff",
    Writing:"rgba(245,166,35,0.1);color:#f5a623",
    Research:"rgba(195,232,141,0.1);color:#c3e88d",
    General:"rgba(128,128,128,0.1);color:#8b949e"
  };

  el.innerHTML = list.map(item => {
    const toneData = toneMap[item.tone||2];
    const catStyle = catColor[item.category||"General"]||catColor.General;
    const preview = (item.content||"").slice(0,120).replace(/\n/g," ");
    const date = (item.updated_at||"").slice(0,10);
    return `<div class="arch-card">
      <div style="display:flex;align-items:start;justify-content:space-between;gap:8px;margin-bottom:8px;">
        <div style="min-width:0;flex:1;">
          <div style="font-size:11px;color:var(--text3);">${date}</div>
          <div style="font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;" title="${esc(item.title)}">${esc(item.title)}</div>
        </div>
        <div style="display:flex;gap:4px;flex-shrink:0;">
          <div class="btn-icon" onclick="loadFromArchive('${item.id}')" title="ë¶ˆëŸ¬ì˜¤ê¸°"><i class="fa-solid fa-arrow-up-right-from-square" style="font-size:11px;"></i></div>
          <div class="btn-icon" onclick="duplicateFromArchive('${item.id}')" title="ë³µì œ"><i class="fa-regular fa-copy" style="font-size:11px;"></i></div>
          <div class="btn-icon danger" onclick="deleteFromArchive('${item.id}')" title="ì‚­ì œ"><i class="fa-regular fa-trash-can" style="font-size:11px;"></i></div>
        </div>
      </div>
      <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px;">
        <span class="badge" style="background:${catStyle};">${esc(item.category||"General")}</span>
        <span class="badge" style="background:${toneData.color}22;color:${toneData.color};">í†¤ Lv.${item.tone||2}</span>
      </div>
      <div style="font-size:11px;color:var(--text3);line-height:1.5;">${esc(preview)}${preview.length===120?"â€¦":""}</div>
    </div>`;
  }).join("");
}

// ==========================================
// EXPORT / IMPORT
// ==========================================
function exportArchive() {
  const data = { app:"Trade Prompt Lab v3", exported_at:nowISO(), items:getArchive() };
  const blob = new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href=url; a.download=`prompt-lab-${nowISO().slice(0,10)}.json`;
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
  toast("âœ“ Export ì™„ë£Œ");
}

function importArchive(input) {
  const f = input.files?.[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const json = JSON.parse(e.target.result);
      const items = Array.isArray(json)?json:(json.items||[]);
      const archive = getArchive();
      const map = new Map(archive.map(x=>[x.id,x]));
      for(const it of items){
        if(!it.id) it.id=uid();
        const prev = map.get(it.id);
        if(!prev||((it.updated_at||"")>(prev.updated_at||""))) map.set(it.id,it);
      }
      setArchive([...map.values()]);
      updateArchCount();
      renderArchive();
      toast(`âœ“ Import: ${items.length}ê°œ ë¡œë“œ`);
    } catch { toast("Import ì‹¤íŒ¨ â€” JSON í™•ì¸", "#ff6b6b"); }
  };
  reader.readAsText(f);
  input.value="";
}

// ==========================================
// INIT
// ==========================================
window.addEventListener("DOMContentLoaded", () => {
  syncTone();
  const loaded = loadDraft();
  if(!loaded) loadTemplate("tariff");
  updateArchCount();

  // API ìƒíƒœ ì´ˆê¸°í™”
  const isNetlify = location.hostname.includes("netlify.app");
  updateApiStatus(isNetlify);

  // auto-assemble on input
  ["p_context","p_vars","p_inst","p_format"].forEach(id=>{
    $(id).addEventListener("input", debouncedAssemble);
  });
  $("category").addEventListener("change", debouncedAssemble);
});

// expose for inline
function switchTheory(id) {
  document.querySelectorAll(".theory-panel").forEach(p => p.style.display = "none");
  const el = document.getElementById(id);
  if (el) el.style.display = "block";
  document.querySelectorAll(".theory-tab").forEach(t => t.classList.remove("active"));
  if (event && event.currentTarget) event.currentTarget.classList.add("active");
  currentTheoryId = id;
}
window.switchPanel = switchPanel;
window.switchTheory = switchTheory;
window.loadTemplate = loadTemplate;
window.loadToBuilder = loadToBuilder;
window.toggleAccordion = toggleAccordion;
window.loadFromArchive = loadFromArchive;
window.duplicateFromArchive = duplicateFromArchive;
window.deleteFromArchive = deleteFromArchive;
window.openApiModal = openApiModal;
window.closeApiModal = closeApiModal;
window.aiExplainCurrentTheory = aiExplainCurrentTheory;
window.closeExplainModal = closeExplainModal;
window.aiAnalyzePrompt = aiAnalyzePrompt;
</script>
</body>
</html>
